{"uid":"9630eec260cb4567","name":"Empty search response will be received when no record is found for the given identifier in search request","fullName":"features.APITests.steps.test_search_steps#test_empty_search_response_will_be_received_when_no_record_is_found_for_the_given_identifier_in_search_request","historyId":"a1e38b1043372aab3fd967d3b71b8f34","time":{"start":1764148122329,"stop":1764148124045,"duration":1716},"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/search.feature: Empty search response will be received when no record is found for the given identifier in search request","descriptionHtml":"<p>/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/search.feature: Empty search response will be received when no record is found for the given identifier in search request</p>\n","status":"failed","statusMessage":"AssertionError: link[0].url should be 'https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization?identifier=None', got 'https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization?identifier=https://www.ieds.england.nhs.uk/|7fba8cf7-0fa0-4172-8751-cfd97efcf6de&_elements=id,meta'\nassert 'https://int....ments=id,meta' == 'https://int....entifier=None'\n  \n  Skipping 75 identical leading characters in diff, use -v to show\n  - dentifier=None\n  + dentifier=https://www.ieds.england.nhs.uk/|7fba8cf7-0fa0-4172-8751-cfd97efcf6de&_elements=id,meta","statusTrace":"fixturefunc = <function validate_empty_immunization_event at 0x7fdd07fb9120>\nrequest = <FixtureRequest for <Function test_empty_search_response_will_be_received_when_no_record_is_found_for_the_given_identifier_in_search_request>>\nkwargs = {'context': <utilities.context.ScenarioContext object at 0x7fdd07e3c790>}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7fdd07e3c790>\n\n    @then('Empty immunization event is returned in the response')\n    def validate_empty_immunization_event(context):\n        response = context.response.json()\n        assert response.get(\"resourceType\") == \"Bundle\", \"resourceType should be 'Bundle'\"\n        assert response.get(\"type\") == \"searchset\", \"type should be 'searchset'\"\n        assert isinstance(response.get(\"entry\"), list) and len(response[\"entry\"]) == 0, \" entry list should be empty\"\n    \n        # Link validation\n        link = response.get(\"link\", [{}])[0]\n        link_url = link.get(\"url\")\n        assert link_url is not None, \" link[0].url is missing\"\n>       assert link_url == f\"{context.baseUrl}/Immunization?identifier=None\", f\"link[0].url should be '{context.baseUrl}/Immunization?identifier=None', got '{link_url}'\"\nE       AssertionError: link[0].url should be 'https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization?identifier=None', got 'https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization?identifier=https://www.ieds.england.nhs.uk/|7fba8cf7-0fa0-4172-8751-cfd97efcf6de&_elements=id,meta'\nE       assert 'https://int....ments=id,meta' == 'https://int....entifier=None'\nE         \nE         Skipping 75 identical leading characters in diff, use -v to show\nE         - dentifier=None\nE         + dentifier=https://www.ieds.england.nhs.uk/|7fba8cf7-0fa0-4172-8751-cfd97efcf6de&_elements=id,meta\n\nfeatures/APITests/steps/test_search_steps.py:305: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup_environment","time":{"start":1764147727515,"stop":1764147727516,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_context","time":{"start":1764147727518,"stop":1764147729207,"duration":1689},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pytest_bdd_example","time":{"start":1764148122328,"stop":1764148122328,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1764148122329,"stop":1764148123525,"duration":1196},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/search.feature: Empty search response will be received when no record is found for the given identifier in search request","status":"failed","statusMessage":"AssertionError: link[0].url should be 'https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization?identifier=None', got 'https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization?identifier=https://www.ieds.england.nhs.uk/|7fba8cf7-0fa0-4172-8751-cfd97efcf6de&_elements=id,meta'\nassert 'https://int....ments=id,meta' == 'https://int....entifier=None'\n  \n  Skipping 75 identical leading characters in diff, use -v to show\n  - dentifier=None\n  + dentifier=https://www.ieds.england.nhs.uk/|7fba8cf7-0fa0-4172-8751-cfd97efcf6de&_elements=id,meta","statusTrace":"fixturefunc = <function validate_empty_immunization_event at 0x7fdd07fb9120>\nrequest = <FixtureRequest for <Function test_empty_search_response_will_be_received_when_no_record_is_found_for_the_given_identifier_in_search_request>>\nkwargs = {'context': <utilities.context.ScenarioContext object at 0x7fdd07e3c790>}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7fdd07e3c790>\n\n    @then('Empty immunization event is returned in the response')\n    def validate_empty_immunization_event(context):\n        response = context.response.json()\n        assert response.get(\"resourceType\") == \"Bundle\", \"resourceType should be 'Bundle'\"\n        assert response.get(\"type\") == \"searchset\", \"type should be 'searchset'\"\n        assert isinstance(response.get(\"entry\"), list) and len(response[\"entry\"]) == 0, \" entry list should be empty\"\n    \n        # Link validation\n        link = response.get(\"link\", [{}])[0]\n        link_url = link.get(\"url\")\n        assert link_url is not None, \" link[0].url is missing\"\n>       assert link_url == f\"{context.baseUrl}/Immunization?identifier=None\", f\"link[0].url should be '{context.baseUrl}/Immunization?identifier=None', got '{link_url}'\"\nE       AssertionError: link[0].url should be 'https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization?identifier=None', got 'https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization?identifier=https://www.ieds.england.nhs.uk/|7fba8cf7-0fa0-4172-8751-cfd97efcf6de&_elements=id,meta'\nE       assert 'https://int....ments=id,meta' == 'https://int....entifier=None'\nE         \nE         Skipping 75 identical leading characters in diff, use -v to show\nE         - dentifier=None\nE         + dentifier=https://www.ieds.england.nhs.uk/|7fba8cf7-0fa0-4172-8751-cfd97efcf6de&_elements=id,meta\n\nfeatures/APITests/steps/test_search_steps.py:305: AssertionError","steps":[],"attachments":[{"uid":"9e360b123fff9f1b","name":"Step Passed: Send a search request with post method using invalid identifier header for Immunization event created","source":"9e360b123fff9f1b.txt","type":"text/plain","size":120},{"uid":"609828aa81b70ed2","name":"Step Passed: The request will be successful with the status code '200'","source":"609828aa81b70ed2.txt","type":"text/plain","size":76},{"uid":"4c8e716c5eb0754e","name":"Step Failed: Empty immunization event is returned in the response","source":"4c8e716c5eb0754e.txt","type":"text/plain","size":639},{"uid":"2d668859dc49d81f","name":"stdout","source":"2d668859dc49d81f.txt","type":"text/plain","size":146}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"epic","value":"Immunization Service"},{"name":"suite","value":"Search the immunization of a patient"},{"name":"feature","value":"Search the immunization of a patient"},{"name":"tag","value":"Search_Feature"},{"name":"tag","value":"patient_id_Random"},{"name":"tag","value":"supplier_name_Postman_Auth"},{"name":"tag","value":"vaccine_type_FLU"},{"name":"tag","value":"functional"},{"name":"parentSuite","value":"features.APITests.steps"},{"name":"host","value":"runnervmg1sw1"},{"name":"thread","value":"2516-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"features.APITests.steps.test_search_steps"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":9,"unknown":0,"total":10},"items":[{"uid":"351bbbf0792873a0","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/162/#testresult/351bbbf0792873a0","status":"passed","time":{"start":1764003404600,"stop":1764003407160,"duration":2560}},{"uid":"7bd390298df3e737","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/159/#testresult/7bd390298df3e737","status":"passed","time":{"start":1763998420940,"stop":1763998422636,"duration":1696}},{"uid":"33f81566fcf24576","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/158/#testresult/33f81566fcf24576","status":"passed","time":{"start":1763997091242,"stop":1763997093874,"duration":2632}},{"uid":"ec807045a7c5275","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/157/#testresult/ec807045a7c5275","status":"passed","time":{"start":1763993091196,"stop":1763993093780,"duration":2584}},{"uid":"db3b3f5625e3db5a","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/156/#testresult/db3b3f5625e3db5a","status":"passed","time":{"start":1763555852599,"stop":1763555854800,"duration":2201}},{"uid":"e9657b57efc03fe0","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/155/#testresult/e9657b57efc03fe0","status":"passed","time":{"start":1763366907393,"stop":1763366909989,"duration":2596}},{"uid":"95ae73cb320a4635","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/154/#testresult/95ae73cb320a4635","status":"passed","time":{"start":1763049485935,"stop":1763049487738,"duration":1803}},{"uid":"bcdcf861e9c16b5c","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/153/#testresult/bcdcf861e9c16b5c","status":"passed","time":{"start":1763046846130,"stop":1763046848684,"duration":2554}},{"uid":"7b514c1beae1bda6","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/152/#testresult/7b514c1beae1bda6","status":"passed","time":{"start":1763040008433,"stop":1763040010911,"duration":2478}}]},"tags":["Search_Feature","vaccine_type_FLU","functional","patient_id_Random","supplier_name_Postman_Auth"]},"source":"9630eec260cb4567.json","parameterValues":[]}