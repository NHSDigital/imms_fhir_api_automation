✅ Pipe-delimited file saved to: /home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/batch_files_directory/COVID_Vaccinations_v5_YGJ_20251113T15252512.csv
Batch file created: COVID_Vaccinations_v5_YGJ_20251113T15252512.csv
Upload successful: COVID_Vaccinations_v5_YGJ_20251113T15252512.csv → immunisation-batch-int-data-sources
Batch file uploaded to S3: COVID_Vaccinations_v5_YGJ_20251113T15252512.csv
Waiting for file in archive: s3://immunisation-batch-int-data-sources/archive/COVID_Vaccinations_v5_YGJ_20251113T15252512.csv
Still waiting... (0s)
Still waiting... (5s)
Still waiting... (10s)
Still waiting... (15s)
Still waiting... (20s)
Still waiting... (25s)
Still waiting... (30s)
Still waiting... (35s)
Still waiting... (40s)
File found in archive: archive/COVID_Vaccinations_v5_YGJ_20251113T15252512.csv
Waiting for file starting with 'ack/COVID_Vaccinations_v5_YGJ_20251113T15252512' in bucket: immunisation-batch-int-data-destinations
[FOUND] File located: ack/COVID_Vaccinations_v5_YGJ_20251113T15252512_InfAck_20251113T15252600.csv
[SUCCESS] File contents loaded (299 bytes)
Waiting for file starting with 'forwardedFile/COVID_Vaccinations_v5_YGJ_20251113T15252512' in bucket: immunisation-batch-int-data-destinations
[FOUND] File located: forwardedFile/COVID_Vaccinations_v5_YGJ_20251113T15252512_BusAck_20251113T15252600.csv
[SUCCESS] File contents loaded (966 bytes)
IMMS_ID mapping:
                                            LOCAL_ID                                            IMMS_ID
0  Fail-invalid_unique_id_uri--20251113T152525^in...  Immunization#ac9957e2-4463-4afa-a2b6-ca036eab430e
1  Fail-invalid_site_Code_uri--20251113T152525^ht...  Immunization#5fef459d-9300-4d36-b546-9e2f38583359
2  Fail-invalid_location_Code_uri-20251113T152525...  Immunization#45edcb1e-69e7-4ecc-a265-cbe99a38fa6a
Attempt 1: Found 1 items

Found Audit detail for filename=COVID_Vaccinations_v5_YGJ_20251113T15252512.csv


 Imms Event response is {'Item': {'Operation': 'CREATE', 'SupplierSystem': 'EMIS', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "840539006", "display": "Disease caused by severe acute respiratory syndrome coronavirus 2"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2025-11-13", "identifier": [{"value": "Fail-invalid_unique_id_uri--20251113T152525", "system": "invalid_uri"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2002-03-13", "gender": "male", "address": [{"postalCode": "DN19 7LP"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9726774098"}], "name": [{"family": "MOSES", "given": ["IQZ-APR-PDS-ALPHA-ZERO"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "42985911000001104", "display": "Spikevax JN.1 COVID-19 mRNA Vaccine 0.1mg/ml dispersion for injection multidose vials (Moderna, Inc)"}]}, "manufacturer": {"display": "Moderna, Inc"}, "expirationDate": "2025-11-13", "lotNumber": "769824", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "1362591000000103", "display": "Immunisation course to maintain protection against severe acute respiratory syndrome coronavirus 2 (regime/therapy)"}]}}], "occurrenceDateTime": "2025-11-13T15:24:35+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368208006", "display": "Left upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "34206005", "display": "Subcutaneous route (qualifier value)"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "ac9957e2-4463-4afa-a2b6-ca036eab430e"}', 'Version': Decimal('1'), 'IdentifierPK': 'invalid_uri#Fail-invalid_unique_id_uri--20251113T152525', 'PatientSK': 'COVID#ac9957e2-4463-4afa-a2b6-ca036eab430e', 'PK': 'Immunization#ac9957e2-4463-4afa-a2b6-ca036eab430e', 'PatientPK': 'Patient#9726774098'}, 'ResponseMetadata': {'RequestId': '8OQEFQ2JTGVKK16O9HVADUTKS7VV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Thu, 13 Nov 2025 15:26:15 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '2993', 'connection': 'keep-alive', 'x-amzn-requestid': '8OQEFQ2JTGVKK16O9HVADUTKS7VV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '993368375'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Item': {'Operation': 'CREATE', 'SupplierSystem': 'EMIS', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "840539006", "display": "Disease caused by severe acute respiratory syndrome coronavirus 2"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2025-11-13", "identifier": [{"value": "Fail-invalid_site_Code_uri--20251113T152525", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2007-12-30", "gender": "male", "address": [{"postalCode": "NE46 2JT"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9652644072"}], "name": [{"family": "GEORGE", "given": ["SIMM"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "43113211000001101", "display": "Comirnaty JN.1 Children 6 months - 4 years COVID-19 mRNA Vaccine 3micrograms/0.3ml dose concentrate for dispersion for injection multidose vials (Pfizer Ltd)"}]}, "manufacturer": {"display": "Pfizer Ltd"}, "expirationDate": "2025-11-13", "lotNumber": "181077", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "1362591000000103", "display": "Immunisation course to maintain protection against severe acute respiratory syndrome coronavirus 2 (regime/therapy)"}]}}], "occurrenceDateTime": "2025-11-13T15:24:35+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368209003", "display": "Right upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "34206005", "display": "Subcutaneous route (qualifier value)"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "invalid_uri", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "5fef459d-9300-4d36-b546-9e2f38583359"}', 'Version': Decimal('1'), 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Fail-invalid_site_Code_uri--20251113T152525', 'PatientSK': 'COVID#5fef459d-9300-4d36-b546-9e2f38583359', 'PK': 'Immunization#5fef459d-9300-4d36-b546-9e2f38583359', 'PatientPK': 'Patient#9652644072'}, 'ResponseMetadata': {'RequestId': '3KGS19P57I749PUH1GIM8EC3S3VV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Thu, 13 Nov 2025 15:26:16 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '3103', 'connection': 'keep-alive', 'x-amzn-requestid': '3KGS19P57I749PUH1GIM8EC3S3VV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '2979150433'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Item': {'Operation': 'CREATE', 'SupplierSystem': 'EMIS', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "840539006", "display": "Disease caused by severe acute respiratory syndrome coronavirus 2"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2025-11-13", "identifier": [{"value": "Fail-invalid_location_Code_uri-20251113T152525", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2006-02-04", "gender": "male", "address": [{"postalCode": "DN22 8PX"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9735023571"}], "name": [{"family": "NATHAN", "given": ["AQZ-MAR-PDS-ALPHA-ZERO"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "43111411000001101", "display": "Comirnaty JN.1 COVID-19 mRNA Vaccine 30micrograms/0.3ml dose dispersion for injection multidose vials (Pfizer Ltd)"}]}, "manufacturer": {"display": "Pfizer Ltd"}, "expirationDate": "2025-11-13", "lotNumber": "122745", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "1362591000000103", "display": "Immunisation course to maintain protection against SARS-CoV-2 (severe acute respiratory syndrome coronavirus 2)"}]}}], "occurrenceDateTime": "2025-11-13T15:24:35+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368209003", "display": "Right upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "34206005", "display": "Subcutaneous route (qualifier value)"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "invalid_uri"}}, "id": "45edcb1e-69e7-4ecc-a265-cbe99a38fa6a"}', 'Version': Decimal('1'), 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Fail-invalid_location_Code_uri-20251113T152525', 'PatientSK': 'COVID#45edcb1e-69e7-4ecc-a265-cbe99a38fa6a', 'PK': 'Immunization#45edcb1e-69e7-4ecc-a265-cbe99a38fa6a', 'PatientPK': 'Patient#9735023571'}, 'ResponseMetadata': {'RequestId': 'PBLI8LCDIA6830H5K6E4EJ0U9NVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Thu, 13 Nov 2025 15:26:16 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '3080', 'connection': 'keep-alive', 'x-amzn-requestid': 'PBLI8LCDIA6830H5K6E4EJ0U9NVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '4121386259'}, 'RetryAttempts': 0}} 

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=ac9957e2-4463-4afa-a2b6-ca036eab430e

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=5fef459d-9300-4d36-b546-9e2f38583359

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=45edcb1e-69e7-4ecc-a265-cbe99a38fa6a

Sending DELETE request to: https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/ac9957e2-4463-4afa-a2b6-ca036eab430e
Sending DELETE request to: https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/5fef459d-9300-4d36-b546-9e2f38583359
Sending DELETE request to: https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/45edcb1e-69e7-4ecc-a265-cbe99a38fa6a
✅ All IMMS_IDs deleted successfully.
