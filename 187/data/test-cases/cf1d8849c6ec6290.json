{"uid":"cf1d8849c6ec6290","name":"Verify that the POST Create API for invalid but Mod11 compliant NHS Number","fullName":"features.APITests.steps.test_create_steps#test_verify_that_the_post_create_api_for_invalid_but_mod11_compliant_nhs_number","historyId":"1d9e989cc85f818d54f7646b314e631f","time":{"start":1765818692777,"stop":1765818702304,"duration":9527},"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/create.feature: Verify that the POST Create API for invalid but Mod11 compliant NHS Number","descriptionHtml":"<p>/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/create.feature: Verify that the POST Create API for invalid but Mod11 compliant NHS Number</p>\n","status":"failed","statusMessage":"AssertionError: Expected status code 204, but got 404. Response: {'resourceType': 'OperationOutcome', 'id': 'db69783a-e78f-4c0c-a667-3f9559cc7c28', 'meta': {'profile': ['https://simplifier.net/guide/UKCoreDevelopment2/ProfileUKCore-OperationOutcome']}, 'issue': [{'severity': 'error', 'code': 'not-found', 'details': {'coding': [{'system': 'https://fhir.nhs.uk/Codesystem/http-error-codes', 'code': 'NOT-FOUND'}]}, 'diagnostics': 'Immunization resource does not exist. ID: None'}]}\nassert 404 == 204\n +  where 404 = <Response [404]>.status_code\n +    where <Response [404]> = <utilities.context.ScenarioContext object at 0x7f823923bf10>.response","statusTrace":"fixturefunc = <function The_request_will_have_status_code at 0x7f8239da87c0>\nrequest = <FixtureRequest for <Function test_verify_that_the_post_create_api_for_invalid_but_mod11_compliant_nhs_number>>\nkwargs = {'context': <utilities.context.ScenarioContext object at 0x7f823923bf10>, 'statusCode': '201'}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7f823923bf10>\nstatusCode = '201'\n\n    @then(parsers.parse(\"The request will be unsuccessful with the status code '{statusCode}'\"))\n    @then(parsers.parse(\"The request will be successful with the status code '{statusCode}'\"))\n    def The_request_will_have_status_code(context, statusCode):\n        print(context.response.status_code)\n        print(int(statusCode))\n>       assert context.response.status_code == int(statusCode), f\"\\n Expected status code: {statusCode}, but got: {context.response.status_code}. Response: {context.response.json()} \\n\"\nE       AssertionError: \nE        Expected status code: 201, but got: 502. Response: {'fault': {'faultstring': 'Unexpected EOF at target', 'detail': {'errorcode': 'messaging.adaptors.http.flow.UnexpectedEOFAtTarget'}}}\n\nfeatures/APITests/steps/common_steps.py:66: AssertionError\n\nDuring handling of the above exception, another exception occurred:\n\nself = <HookCaller 'pytest_bdd_after_scenario'>\nkwargs = {'feature': Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', ScenarioTem...tion='', tags={'Delete_cleanUp', 'supplier_name_Postman_Auth', 'vaccine_type_RSV', 'patient_id_Mod11_NHS'}, rule=None)}\nfirstresult = False\n\n    def __call__(self, **kwargs: object) -> Any:\n        \"\"\"Call the hook.\n    \n        Only accepts keyword arguments, which should match the hook\n        specification.\n    \n        Returns the result(s) of calling all registered plugins, see\n        :ref:`calling`.\n        \"\"\"\n        assert (\n            not self.is_historic()\n        ), \"Cannot directly call a historic hook - use call_historic instead.\"\n        self._verify_all_args_are_provided(kwargs)\n        firstresult = self.spec.opts.get(\"firstresult\", False) if self.spec else False\n        # Copy because plugins may register other plugins during iteration (#438).\n>       return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n\nvenv/lib/python3.11/site-packages/pluggy/_hooks.py:513: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.11/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nrequest = <FixtureRequest for <Function test_verify_that_the_post_create_api_for_invalid_but_mod11_compliant_nhs_number>>\nfeature = Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', ScenarioTemplate(featur...munization event for a patient', tags={'Create_Feature', 'functional'}, background=None, line_number=2, description='')\nscenario = Scenario(feature=Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', Scenar...ption='', tags={'Delete_cleanUp', 'supplier_name_Postman_Auth', 'vaccine_type_RSV', 'patient_id_Mod11_NHS'}, rule=None)\n\n    def pytest_bdd_after_scenario(request, feature, scenario):\n        tags = set(getattr(scenario, 'tags', [])) | set(getattr(feature, 'tags', []))\n        context = request.getfixturevalue('context')\n        get_delete_url_header(context)\n    \n        if 'Delete_cleanUp' in tags:\n            print(f\"\\n Delete Request is {context.url}/{context.ImmsID}\")\n            context.response = requests.delete(f\"{context.url}/{context.ImmsID}\", headers=context.headers)\n>           assert context.response.status_code == 204, f\"Expected status code 204, but got {context.response.status_code}. Response: {context.response.json()}\"\nE           AssertionError: Expected status code 204, but got 404. Response: {'resourceType': 'OperationOutcome', 'id': 'db69783a-e78f-4c0c-a667-3f9559cc7c28', 'meta': {'profile': ['https://simplifier.net/guide/UKCoreDevelopment2/ProfileUKCore-OperationOutcome']}, 'issue': [{'severity': 'error', 'code': 'not-found', 'details': {'coding': [{'system': 'https://fhir.nhs.uk/Codesystem/http-error-codes', 'code': 'NOT-FOUND'}]}, 'diagnostics': 'Immunization resource does not exist. ID: None'}]}\nE           assert 404 == 204\nE            +  where 404 = <Response [404]>.status_code\nE            +    where <Response [404]> = <utilities.context.ScenarioContext object at 0x7f823923bf10>.response\n\nfeatures/conftest.py:86: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup_environment","time":{"start":1765818597595,"stop":1765818597595,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_context","time":{"start":1765818597598,"stop":1765818599403,"duration":1805},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pytest_bdd_example","time":{"start":1765818692776,"stop":1765818692776,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1765818692777,"stop":1765818694418,"duration":1641},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/create.feature: Verify that the POST Create API for invalid but Mod11 compliant NHS Number","status":"failed","statusMessage":"AssertionError: Expected status code 204, but got 404. Response: {'resourceType': 'OperationOutcome', 'id': 'db69783a-e78f-4c0c-a667-3f9559cc7c28', 'meta': {'profile': ['https://simplifier.net/guide/UKCoreDevelopment2/ProfileUKCore-OperationOutcome']}, 'issue': [{'severity': 'error', 'code': 'not-found', 'details': {'coding': [{'system': 'https://fhir.nhs.uk/Codesystem/http-error-codes', 'code': 'NOT-FOUND'}]}, 'diagnostics': 'Immunization resource does not exist. ID: None'}]}\nassert 404 == 204\n +  where 404 = <Response [404]>.status_code\n +    where <Response [404]> = <utilities.context.ScenarioContext object at 0x7f823923bf10>.response","statusTrace":"fixturefunc = <function The_request_will_have_status_code at 0x7f8239da87c0>\nrequest = <FixtureRequest for <Function test_verify_that_the_post_create_api_for_invalid_but_mod11_compliant_nhs_number>>\nkwargs = {'context': <utilities.context.ScenarioContext object at 0x7f823923bf10>, 'statusCode': '201'}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7f823923bf10>\nstatusCode = '201'\n\n    @then(parsers.parse(\"The request will be unsuccessful with the status code '{statusCode}'\"))\n    @then(parsers.parse(\"The request will be successful with the status code '{statusCode}'\"))\n    def The_request_will_have_status_code(context, statusCode):\n        print(context.response.status_code)\n        print(int(statusCode))\n>       assert context.response.status_code == int(statusCode), f\"\\n Expected status code: {statusCode}, but got: {context.response.status_code}. Response: {context.response.json()} \\n\"\nE       AssertionError: \nE        Expected status code: 201, but got: 502. Response: {'fault': {'faultstring': 'Unexpected EOF at target', 'detail': {'errorcode': 'messaging.adaptors.http.flow.UnexpectedEOFAtTarget'}}}\n\nfeatures/APITests/steps/common_steps.py:66: AssertionError\n\nDuring handling of the above exception, another exception occurred:\n\nself = <HookCaller 'pytest_bdd_after_scenario'>\nkwargs = {'feature': Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', ScenarioTem...tion='', tags={'Delete_cleanUp', 'supplier_name_Postman_Auth', 'vaccine_type_RSV', 'patient_id_Mod11_NHS'}, rule=None)}\nfirstresult = False\n\n    def __call__(self, **kwargs: object) -> Any:\n        \"\"\"Call the hook.\n    \n        Only accepts keyword arguments, which should match the hook\n        specification.\n    \n        Returns the result(s) of calling all registered plugins, see\n        :ref:`calling`.\n        \"\"\"\n        assert (\n            not self.is_historic()\n        ), \"Cannot directly call a historic hook - use call_historic instead.\"\n        self._verify_all_args_are_provided(kwargs)\n        firstresult = self.spec.opts.get(\"firstresult\", False) if self.spec else False\n        # Copy because plugins may register other plugins during iteration (#438).\n>       return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n\nvenv/lib/python3.11/site-packages/pluggy/_hooks.py:513: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.11/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nrequest = <FixtureRequest for <Function test_verify_that_the_post_create_api_for_invalid_but_mod11_compliant_nhs_number>>\nfeature = Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', ScenarioTemplate(featur...munization event for a patient', tags={'Create_Feature', 'functional'}, background=None, line_number=2, description='')\nscenario = Scenario(feature=Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', Scenar...ption='', tags={'Delete_cleanUp', 'supplier_name_Postman_Auth', 'vaccine_type_RSV', 'patient_id_Mod11_NHS'}, rule=None)\n\n    def pytest_bdd_after_scenario(request, feature, scenario):\n        tags = set(getattr(scenario, 'tags', [])) | set(getattr(feature, 'tags', []))\n        context = request.getfixturevalue('context')\n        get_delete_url_header(context)\n    \n        if 'Delete_cleanUp' in tags:\n            print(f\"\\n Delete Request is {context.url}/{context.ImmsID}\")\n            context.response = requests.delete(f\"{context.url}/{context.ImmsID}\", headers=context.headers)\n>           assert context.response.status_code == 204, f\"Expected status code 204, but got {context.response.status_code}. Response: {context.response.json()}\"\nE           AssertionError: Expected status code 204, but got 404. Response: {'resourceType': 'OperationOutcome', 'id': 'db69783a-e78f-4c0c-a667-3f9559cc7c28', 'meta': {'profile': ['https://simplifier.net/guide/UKCoreDevelopment2/ProfileUKCore-OperationOutcome']}, 'issue': [{'severity': 'error', 'code': 'not-found', 'details': {'coding': [{'system': 'https://fhir.nhs.uk/Codesystem/http-error-codes', 'code': 'NOT-FOUND'}]}, 'diagnostics': 'Immunization resource does not exist. ID: None'}]}\nE           assert 404 == 204\nE            +  where 404 = <Response [404]>.status_code\nE            +    where <Response [404]> = <utilities.context.ScenarioContext object at 0x7f823923bf10>.response\n\nfeatures/conftest.py:86: AssertionError","steps":[],"attachments":[{"uid":"e4fc493931e94eb5","name":"Step Passed: Valid json payload is created","source":"e4fc493931e94eb5.txt","type":"text/plain","size":48},{"uid":"9954c449eca0fecb","name":"Step Passed: Trigger the post create request","source":"9954c449eca0fecb.txt","type":"text/plain","size":50},{"uid":"17dedf321d5aba03","name":"Step Failed: The request will be successful with the status code '201'","source":"17dedf321d5aba03.txt","type":"text/plain","size":276},{"uid":"f0dca6d67d20e4b","name":"stdout","source":"f0dca6d67d20e4b.txt","type":"text/plain","size":4112}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"epic","value":"Immunization Service"},{"name":"suite","value":"Create the immunization event for a patient"},{"name":"feature","value":"Create the immunization event for a patient"},{"name":"tag","value":"Create_Feature"},{"name":"tag","value":"supplier_name_Postman_Auth"},{"name":"tag","value":"vaccine_type_RSV"},{"name":"tag","value":"patient_id_Mod11_NHS"},{"name":"tag","value":"Delete_cleanUp"},{"name":"tag","value":"functional"},{"name":"parentSuite","value":"features.APITests.steps"},{"name":"host","value":"runnervm6qbrg"},{"name":"thread","value":"2608-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"features.APITests.steps.test_create_steps"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":1,"skipped":0,"passed":24,"unknown":0,"total":26},"items":[{"uid":"7360cb520e6211c3","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/181/#testresult/7360cb520e6211c3","status":"passed","time":{"start":1765545850403,"stop":1765545855039,"duration":4636}},{"uid":"eff6eca693102e25","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/180/#testresult/eff6eca693102e25","status":"broken","statusDetails":"requests.exceptions.InvalidURL: URL has an invalid label.","time":{"start":1765545408787,"stop":1765545408788,"duration":1}},{"uid":"65e56abe1327ee29","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/179/#testresult/65e56abe1327ee29","status":"passed","time":{"start":1765465724603,"stop":1765465731898,"duration":7295}},{"uid":"c90b7a0c79b6f3b7","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/177/#testresult/c90b7a0c79b6f3b7","status":"passed","time":{"start":1765398459084,"stop":1765398462746,"duration":3662}},{"uid":"2433c5ffc433116e","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/176/#testresult/2433c5ffc433116e","status":"passed","time":{"start":1765384988825,"stop":1765384993153,"duration":4328}},{"uid":"1641584c298e61e8","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/175/#testresult/1641584c298e61e8","status":"passed","time":{"start":1765000619939,"stop":1765000625213,"duration":5274}},{"uid":"2cc88442bff18489","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/173/#testresult/2cc88442bff18489","status":"passed","time":{"start":1764972397032,"stop":1764972400816,"duration":3784}},{"uid":"ae9ac8d41b096c7c","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/171/#testresult/ae9ac8d41b096c7c","status":"passed","time":{"start":1764333007250,"stop":1764333016297,"duration":9047}},{"uid":"95e0b5966b5d33fe","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/170/#testresult/95e0b5966b5d33fe","status":"passed","time":{"start":1764256580078,"stop":1764256584677,"duration":4599}},{"uid":"80961dbc1fe7b670","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/169/#testresult/80961dbc1fe7b670","status":"passed","time":{"start":1764236003207,"stop":1764236007866,"duration":4659}},{"uid":"8fc2499c861960d7","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/168/#testresult/8fc2499c861960d7","status":"passed","time":{"start":1764230969944,"stop":1764230974673,"duration":4729}},{"uid":"47b5a05cd9b2928b","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/167/#testresult/47b5a05cd9b2928b","status":"passed","time":{"start":1764183943203,"stop":1764183947231,"duration":4028}},{"uid":"c7c4fadd1e9413cd","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/166/#testresult/c7c4fadd1e9413cd","status":"passed","time":{"start":1764182779722,"stop":1764182783031,"duration":3309}},{"uid":"b3f032ab65935693","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/165/#testresult/b3f032ab65935693","status":"passed","time":{"start":1764181916799,"stop":1764181922727,"duration":5928}},{"uid":"fbdfcff1f165124f","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/164/#testresult/fbdfcff1f165124f","status":"passed","time":{"start":1764147811152,"stop":1764147814092,"duration":2940}},{"uid":"adba77bf5979f736","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/162/#testresult/adba77bf5979f736","status":"passed","time":{"start":1764003042286,"stop":1764003046917,"duration":4631}},{"uid":"6c4748b48b7acad0","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/161/#testresult/6c4748b48b7acad0","status":"passed","time":{"start":1764002594544,"stop":1764002597943,"duration":3399}},{"uid":"e5e0efa2f406dd64","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/159/#testresult/e5e0efa2f406dd64","status":"passed","time":{"start":1763998183491,"stop":1763998186378,"duration":2887}},{"uid":"2f19716efe3e4eec","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/158/#testresult/2f19716efe3e4eec","status":"passed","time":{"start":1763996727273,"stop":1763996731848,"duration":4575}},{"uid":"6ef23fa19dfa2982","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/157/#testresult/6ef23fa19dfa2982","status":"passed","time":{"start":1763992855765,"stop":1763992859712,"duration":3947}}]},"tags":["functional","Create_Feature","supplier_name_Postman_Auth","vaccine_type_RSV","patient_id_Mod11_NHS","Delete_cleanUp"]},"source":"cf1d8849c6ec6290.json","parameterValues":[]}