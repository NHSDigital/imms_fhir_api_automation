{"uid":"2156ce639df03ca","name":"Verify that the Update API will be successful with invalid but Mod11 compliant NHS Number","fullName":"features.APITests.steps.test_update_steps#test_verify_that_the_update_api_will_be_successful_with_invalid_but_mod11_compliant_nhs_number","historyId":"48e074e2c62ee11a3f46538058680af9","time":{"start":1765895096910,"stop":1765895114054,"duration":17144},"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/update.feature: Verify that the Update API will be successful with invalid but Mod11 compliant NHS Number","descriptionHtml":"<p>/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/update.feature: Verify that the Update API will be successful with invalid but Mod11 compliant NHS Number</p>\n","status":"failed","statusMessage":"AssertionError: Expected status code 204, but got 502. Response: {'fault': {'faultstring': 'Unexpected EOF at target', 'detail': {'errorcode': 'messaging.adaptors.http.flow.UnexpectedEOFAtTarget'}}}\nassert 502 == 204\n +  where 502 = <Response [502]>.status_code\n +    where <Response [502]> = <utilities.context.ScenarioContext object at 0x7fe210930e10>.response","statusTrace":"fixturefunc = <function The_request_will_have_status_code at 0x7fe211cc07c0>\nrequest = <FixtureRequest for <Function test_verify_that_the_update_api_will_be_successful_with_invalid_but_mod11_compliant_nhs_number>>\nkwargs = {'context': <utilities.context.ScenarioContext object at 0x7fe210930e10>, 'statusCode': '200'}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7fe210930e10>\nstatusCode = '200'\n\n    @then(parsers.parse(\"The request will be unsuccessful with the status code '{statusCode}'\"))\n    @then(parsers.parse(\"The request will be successful with the status code '{statusCode}'\"))\n    def The_request_will_have_status_code(context, statusCode):\n        print(context.response.status_code)\n        print(int(statusCode))\n>       assert context.response.status_code == int(statusCode), f\"\\n Expected status code: {statusCode}, but got: {context.response.status_code}. Response: {context.response.json()} \\n\"\nE       AssertionError: \nE        Expected status code: 200, but got: 502. Response: {'fault': {'faultstring': 'Unexpected EOF at target', 'detail': {'errorcode': 'messaging.adaptors.http.flow.UnexpectedEOFAtTarget'}}}\n\nfeatures/APITests/steps/common_steps.py:66: AssertionError\n\nDuring handling of the above exception, another exception occurred:\n\nself = <HookCaller 'pytest_bdd_after_scenario'>\nkwargs = {'feature': Feature(scenarios=OrderedDict([('Verify that the Update API will be successful with all the valid paramete...tion='', tags={'supplier_name_Postman_Auth', 'vaccine_type_RSV', 'patient_id_Mod11_NHS', 'Delete_cleanUp'}, rule=None)}\nfirstresult = False\n\n    def __call__(self, **kwargs: object) -> Any:\n        \"\"\"Call the hook.\n    \n        Only accepts keyword arguments, which should match the hook\n        specification.\n    \n        Returns the result(s) of calling all registered plugins, see\n        :ref:`calling`.\n        \"\"\"\n        assert (\n            not self.is_historic()\n        ), \"Cannot directly call a historic hook - use call_historic instead.\"\n        self._verify_all_args_are_provided(kwargs)\n        firstresult = self.spec.opts.get(\"firstresult\", False) if self.spec else False\n        # Copy because plugins may register other plugins during iteration (#438).\n>       return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n\nvenv/lib/python3.11/site-packages/pluggy/_hooks.py:513: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.11/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nrequest = <FixtureRequest for <Function test_verify_that_the_update_api_will_be_successful_with_invalid_but_mod11_compliant_nhs_number>>\nfeature = Feature(scenarios=OrderedDict([('Verify that the Update API will be successful with all the valid parameters', Scenari... the immunization of a patient', tags={'functional', 'Update_Feature'}, background=None, line_number=2, description='')\nscenario = Scenario(feature=Feature(scenarios=OrderedDict([('Verify that the Update API will be successful with all the valid par...ption='', tags={'supplier_name_Postman_Auth', 'vaccine_type_RSV', 'patient_id_Mod11_NHS', 'Delete_cleanUp'}, rule=None)\n\n    def pytest_bdd_after_scenario(request, feature, scenario):\n        tags = set(getattr(scenario, 'tags', [])) | set(getattr(feature, 'tags', []))\n        context = request.getfixturevalue('context')\n        get_delete_url_header(context)\n    \n        if 'Delete_cleanUp' in tags:\n            if context.ImmsID is not None:\n                print(f\"\\n Delete Request is {context.url}/{context.ImmsID}\")\n                context.response = requests.delete(f\"{context.url}/{context.ImmsID}\", headers=context.headers)\n>               assert context.response.status_code == 204, f\"Expected status code 204, but got {context.response.status_code}. Response: {context.response.json()}\"\nE               AssertionError: Expected status code 204, but got 502. Response: {'fault': {'faultstring': 'Unexpected EOF at target', 'detail': {'errorcode': 'messaging.adaptors.http.flow.UnexpectedEOFAtTarget'}}}\nE               assert 502 == 204\nE                +  where 502 = <Response [502]>.status_code\nE                +    where <Response [502]> = <utilities.context.ScenarioContext object at 0x7fe210930e10>.response\n\nfeatures/conftest.py:87: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup_environment","time":{"start":1765894612212,"stop":1765894612212,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_context","time":{"start":1765894612215,"stop":1765894613890,"duration":1675},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pytest_bdd_example","time":{"start":1765895096910,"stop":1765895096910,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1765895096911,"stop":1765895098920,"duration":2009},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/update.feature: Verify that the Update API will be successful with invalid but Mod11 compliant NHS Number","status":"failed","statusMessage":"AssertionError: Expected status code 204, but got 502. Response: {'fault': {'faultstring': 'Unexpected EOF at target', 'detail': {'errorcode': 'messaging.adaptors.http.flow.UnexpectedEOFAtTarget'}}}\nassert 502 == 204\n +  where 502 = <Response [502]>.status_code\n +    where <Response [502]> = <utilities.context.ScenarioContext object at 0x7fe210930e10>.response","statusTrace":"fixturefunc = <function The_request_will_have_status_code at 0x7fe211cc07c0>\nrequest = <FixtureRequest for <Function test_verify_that_the_update_api_will_be_successful_with_invalid_but_mod11_compliant_nhs_number>>\nkwargs = {'context': <utilities.context.ScenarioContext object at 0x7fe210930e10>, 'statusCode': '200'}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7fe210930e10>\nstatusCode = '200'\n\n    @then(parsers.parse(\"The request will be unsuccessful with the status code '{statusCode}'\"))\n    @then(parsers.parse(\"The request will be successful with the status code '{statusCode}'\"))\n    def The_request_will_have_status_code(context, statusCode):\n        print(context.response.status_code)\n        print(int(statusCode))\n>       assert context.response.status_code == int(statusCode), f\"\\n Expected status code: {statusCode}, but got: {context.response.status_code}. Response: {context.response.json()} \\n\"\nE       AssertionError: \nE        Expected status code: 200, but got: 502. Response: {'fault': {'faultstring': 'Unexpected EOF at target', 'detail': {'errorcode': 'messaging.adaptors.http.flow.UnexpectedEOFAtTarget'}}}\n\nfeatures/APITests/steps/common_steps.py:66: AssertionError\n\nDuring handling of the above exception, another exception occurred:\n\nself = <HookCaller 'pytest_bdd_after_scenario'>\nkwargs = {'feature': Feature(scenarios=OrderedDict([('Verify that the Update API will be successful with all the valid paramete...tion='', tags={'supplier_name_Postman_Auth', 'vaccine_type_RSV', 'patient_id_Mod11_NHS', 'Delete_cleanUp'}, rule=None)}\nfirstresult = False\n\n    def __call__(self, **kwargs: object) -> Any:\n        \"\"\"Call the hook.\n    \n        Only accepts keyword arguments, which should match the hook\n        specification.\n    \n        Returns the result(s) of calling all registered plugins, see\n        :ref:`calling`.\n        \"\"\"\n        assert (\n            not self.is_historic()\n        ), \"Cannot directly call a historic hook - use call_historic instead.\"\n        self._verify_all_args_are_provided(kwargs)\n        firstresult = self.spec.opts.get(\"firstresult\", False) if self.spec else False\n        # Copy because plugins may register other plugins during iteration (#438).\n>       return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n\nvenv/lib/python3.11/site-packages/pluggy/_hooks.py:513: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.11/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nrequest = <FixtureRequest for <Function test_verify_that_the_update_api_will_be_successful_with_invalid_but_mod11_compliant_nhs_number>>\nfeature = Feature(scenarios=OrderedDict([('Verify that the Update API will be successful with all the valid parameters', Scenari... the immunization of a patient', tags={'functional', 'Update_Feature'}, background=None, line_number=2, description='')\nscenario = Scenario(feature=Feature(scenarios=OrderedDict([('Verify that the Update API will be successful with all the valid par...ption='', tags={'supplier_name_Postman_Auth', 'vaccine_type_RSV', 'patient_id_Mod11_NHS', 'Delete_cleanUp'}, rule=None)\n\n    def pytest_bdd_after_scenario(request, feature, scenario):\n        tags = set(getattr(scenario, 'tags', [])) | set(getattr(feature, 'tags', []))\n        context = request.getfixturevalue('context')\n        get_delete_url_header(context)\n    \n        if 'Delete_cleanUp' in tags:\n            if context.ImmsID is not None:\n                print(f\"\\n Delete Request is {context.url}/{context.ImmsID}\")\n                context.response = requests.delete(f\"{context.url}/{context.ImmsID}\", headers=context.headers)\n>               assert context.response.status_code == 204, f\"Expected status code 204, but got {context.response.status_code}. Response: {context.response.json()}\"\nE               AssertionError: Expected status code 204, but got 502. Response: {'fault': {'faultstring': 'Unexpected EOF at target', 'detail': {'errorcode': 'messaging.adaptors.http.flow.UnexpectedEOFAtTarget'}}}\nE               assert 502 == 204\nE                +  where 502 = <Response [502]>.status_code\nE                +    where <Response [502]> = <utilities.context.ScenarioContext object at 0x7fe210930e10>.response\n\nfeatures/conftest.py:87: AssertionError","steps":[],"attachments":[{"uid":"67aa25937d405b8","name":"Step Passed: I have created a valid vaccination record","source":"67aa25937d405b8.txt","type":"text/plain","size":60},{"uid":"5837c2b60106df02","name":"Step Passed: Send a update for Immunization event created with patient address being updated","source":"5837c2b60106df02.txt","type":"text/plain","size":98},{"uid":"474afaffbaafc0a4","name":"Step Failed: The request will be successful with the status code '200'","source":"474afaffbaafc0a4.txt","type":"text/plain","size":276},{"uid":"9e255bc91f791fd4","name":"stdout","source":"9e255bc91f791fd4.txt","type":"text/plain","size":8289}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"epic","value":"Immunization Service"},{"name":"suite","value":"Update the immunization of a patient"},{"name":"feature","value":"Update the immunization of a patient"},{"name":"tag","value":"vaccine_type_RSV"},{"name":"tag","value":"functional"},{"name":"tag","value":"Delete_cleanUp"},{"name":"tag","value":"patient_id_Mod11_NHS"},{"name":"tag","value":"Update_Feature"},{"name":"tag","value":"supplier_name_Postman_Auth"},{"name":"parentSuite","value":"features.APITests.steps"},{"name":"host","value":"runnervm6qbrg"},{"name":"thread","value":"2532-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"features.APITests.steps.test_update_steps"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":3,"broken":1,"skipped":0,"passed":25,"unknown":0,"total":29},"items":[{"uid":"ee10ea4e769c1e48","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/190/#testresult/ee10ea4e769c1e48","status":"passed","time":{"start":1765890540066,"stop":1765890544865,"duration":4799}},{"uid":"1563b3b5815d78dd","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/189/#testresult/1563b3b5815d78dd","status":"passed","time":{"start":1765889626368,"stop":1765889634315,"duration":7947}},{"uid":"4d35c56fe78f1ec6","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/188/#testresult/4d35c56fe78f1ec6","status":"passed","time":{"start":1765877616682,"stop":1765877623944,"duration":7262}},{"uid":"bcb492a7ecaa91a8","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/187/#testresult/bcb492a7ecaa91a8","status":"passed","time":{"start":1765819101531,"stop":1765819106402,"duration":4871}},{"uid":"2aa177e380262e0f","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/181/#testresult/2aa177e380262e0f","status":"passed","time":{"start":1765546271097,"stop":1765546277322,"duration":6225}},{"uid":"defffa4baff18bb4","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/180/#testresult/defffa4baff18bb4","status":"broken","statusDetails":"requests.exceptions.InvalidURL: URL has an invalid label.","time":{"start":1765545419829,"stop":1765545419831,"duration":2}},{"uid":"9149f4f9bc066b2e","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/179/#testresult/9149f4f9bc066b2e","status":"passed","time":{"start":1765466181972,"stop":1765466187851,"duration":5879}},{"uid":"a154a3a0b20d34a8","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/177/#testresult/a154a3a0b20d34a8","status":"passed","time":{"start":1765398872108,"stop":1765398876520,"duration":4412}},{"uid":"ded07c91d6e4f799","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/176/#testresult/ded07c91d6e4f799","status":"passed","time":{"start":1765385347445,"stop":1765385351448,"duration":4003}},{"uid":"918f74cdaa097c78","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/175/#testresult/918f74cdaa097c78","status":"failed","statusDetails":"AssertionError: Expected status code 204, but got 404. Response: {'resourceType': 'OperationOutcome', 'id': '557e8df6-2aa5-4ab4-b651-65d731bd5b9e', 'meta': {'profile': ['https://simplifier.net/guide/UKCoreDevelopment2/ProfileUKCore-OperationOutcome']}, 'issue': [{'severity': 'error', 'code': 'not-found', 'details': {'coding': [{'system': 'https://fhir.nhs.uk/Codesystem/http-error-codes', 'code': 'NOT-FOUND'}]}, 'diagnostics': 'Immunization resource does not exist. ID: None'}]}\nassert 404 == 204\n +  where 404 = <Response [404]>.status_code\n +    where <Response [404]> = <utilities.context.ScenarioContext object at 0x7fee12003fd0>.response","time":{"start":1765001047452,"stop":1765001058668,"duration":11216}},{"uid":"30a72406af4b8266","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/173/#testresult/30a72406af4b8266","status":"passed","time":{"start":1764972767859,"stop":1764972772027,"duration":4168}},{"uid":"e00ac1851e6228d5","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/171/#testresult/e00ac1851e6228d5","status":"passed","time":{"start":1764333376711,"stop":1764333380111,"duration":3400}},{"uid":"6d38069b0f9bd8a7","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/170/#testresult/6d38069b0f9bd8a7","status":"passed","time":{"start":1764257088875,"stop":1764257094503,"duration":5628}},{"uid":"37ae3db1a2fc8b6c","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/169/#testresult/37ae3db1a2fc8b6c","status":"passed","time":{"start":1764236415708,"stop":1764236423043,"duration":7335}},{"uid":"e407394a6e777fec","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/168/#testresult/e407394a6e777fec","status":"passed","time":{"start":1764231441138,"stop":1764231446527,"duration":5389}},{"uid":"f69b70f257654247","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/167/#testresult/f69b70f257654247","status":"passed","time":{"start":1764184332112,"stop":1764184338182,"duration":6070}},{"uid":"dfafc380cb720f47","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/166/#testresult/dfafc380cb720f47","status":"failed","statusDetails":"AssertionError: Expected status code 204, but got 404. Response: {'resourceType': 'OperationOutcome', 'id': 'bd529b80-4935-4787-ac0c-63531a6d86f1', 'meta': {'profile': ['https://simplifier.net/guide/UKCoreDevelopment2/ProfileUKCore-OperationOutcome']}, 'issue': [{'severity': 'error', 'code': 'not-found', 'details': {'coding': [{'system': 'https://fhir.nhs.uk/Codesystem/http-error-codes', 'code': 'NOT-FOUND'}]}, 'diagnostics': 'Immunization resource does not exist. ID: None'}]}\nassert 404 == 204\n +  where 404 = <Response [404]>.status_code\n +    where <Response [404]> = <utilities.context.ScenarioContext object at 0x7fa2a81fc690>.response","time":{"start":1764183086187,"stop":1764183094994,"duration":8807}},{"uid":"dafe1c86c586cf65","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/165/#testresult/dafe1c86c586cf65","status":"passed","time":{"start":1764182356129,"stop":1764182360807,"duration":4678}},{"uid":"1b08ee4726ea837","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/164/#testresult/1b08ee4726ea837","status":"passed","time":{"start":1764148144522,"stop":1764148148023,"duration":3501}},{"uid":"ddd8fa4ca1daf2af","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/162/#testresult/ddd8fa4ca1daf2af","status":"passed","time":{"start":1764003436081,"stop":1764003441414,"duration":5333}}]},"tags":["functional","Update_Feature","supplier_name_Postman_Auth","vaccine_type_RSV","Delete_cleanUp","patient_id_Mod11_NHS"]},"source":"2156ce639df03ca.json","parameterValues":[]}