✅ Pipe-delimited file saved to: /home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/batch_files_directory/MMR_Vaccinations_v5_V0V8L_20251106T12574929.csv
Batch file created: MMR_Vaccinations_v5_V0V8L_20251106T12574929.csv
Upload successful: MMR_Vaccinations_v5_V0V8L_20251106T12574929.csv → immunisation-batch-int-data-sources
Batch file uploaded to S3: MMR_Vaccinations_v5_V0V8L_20251106T12574929.csv
Waiting for file in archive: s3://immunisation-batch-int-data-sources/archive/MMR_Vaccinations_v5_V0V8L_20251106T12574929.csv
Still waiting... (0s)
Still waiting... (5s)
Still waiting... (10s)
Still waiting... (15s)
Still waiting... (20s)
Still waiting... (25s)
Still waiting... (30s)
Still waiting... (35s)
Still waiting... (40s)
Still waiting... (45s)
File found in archive: archive/MMR_Vaccinations_v5_V0V8L_20251106T12574929.csv
Waiting for file starting with 'ack/MMR_Vaccinations_v5_V0V8L_20251106T12574929' in bucket: immunisation-batch-int-data-destinations
File found: ack/MMR_Vaccinations_v5_V0V8L_20251106T12574929_InfAck_20251106T12575000.csv
File contents loaded (299 bytes)
Waiting for file starting with 'forwardedFile/MMR_Vaccinations_v5_V0V8L_20251106T12574929' in bucket: immunisation-batch-int-data-destinations
File found: forwardedFile/MMR_Vaccinations_v5_V0V8L_20251106T12574929_BusAck_20251106T12575000.csv
File contents loaded (1493 bytes)
IMMS_ID mapping:
                                            LOCAL_ID                                            IMMS_ID
0  Valid_NhsNumber-20251106T125749^https://fhir.n...  Immunization#ceff2300-e744-4aaa-9071-f56bf442bf75
1  InvalidInPDS_NhsNumber-20251106T125749^https:/...  Immunization#148b43e8-27fa-4452-84f8-081331947a04
2  SFlag_NhsNumber-20251106T125749^https://fhir.n...  Immunization#0786305e-9a05-44e5-9389-7be76752116b
3  Mod11_NhSNumber-20251106T125749^https://fhir.n...  Immunization#2ebfa301-f427-4a86-9e8d-141eefeb42a7
4  OldNHSNo-20251106T125749^https://fhir.nhs.uk/I...  Immunization#4ca9fb06-2132-4e81-ac95-d9ca775ac8d7

 Scan response for filename = MMR_Vaccinations_v5_V0V8L_20251106T12574929.csv: [{'filename': 'MMR_Vaccinations_v5_V0V8L_20251106T12574929.csv', 'record_count': Decimal('5'), 'queue_name': 'MAVIS_MMR', 'status': 'Processed', 'timestamp': '20251106T12575000', 'message_id': '6b193985-dbf5-42e4-aa97-0e3f91c230d8', 'expires_at': Decimal('1767617870')}]


 Imms Event response is {'Item': {'Operation': 'CREATE', 'SupplierSystem': 'MAVIS', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "14189004", "display": "Measles"}]}, {"coding": [{"system": "http://snomed.info/sct", "code": "36989005", "display": "Mumps"}]}, {"coding": [{"system": "http://snomed.info/sct", "code": "36653000", "display": "Rubella"}]}], "doseNumberString": "Dose sequence not recorded"}], "recorded": "2025-11-06", "identifier": [{"value": "Valid_NhsNumber-20251106T125749", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2005-12-25", "gender": "male", "address": [{"postalCode": "LS23 7AH"}], "name": [{"family": "CECIL", "given": ["SIM"]}]}], "vaccineCode": {"coding": [{"system": "http://terminology.hl7.org/CodeSystem/v3-NullFlavor", "code": "NAVU", "display": "Not available"}]}, "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "170433008"}]}}], "occurrenceDateTime": "2025-11-06T12:56:59+00:00", "primarySource": true, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "ceff2300-e744-4aaa-9071-f56bf442bf75"}', 'Version': Decimal('1'), 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Valid_NhsNumber-20251106T125749', 'PatientSK': 'MMR#ceff2300-e744-4aaa-9071-f56bf442bf75', 'PK': 'Immunization#ceff2300-e744-4aaa-9071-f56bf442bf75', 'PatientPK': 'Patient#TBC'}, 'ResponseMetadata': {'RequestId': '26M1NCGOF64HIV0KCOJU7M6FUFVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Thu, 06 Nov 2025 12:58:42 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '2115', 'connection': 'keep-alive', 'x-amzn-requestid': '26M1NCGOF64HIV0KCOJU7M6FUFVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '2909273182'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Item': {'Operation': 'CREATE', 'SupplierSystem': 'MAVIS', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "14189004", "display": "Measles"}]}, {"coding": [{"system": "http://snomed.info/sct", "code": "36989005", "display": "Mumps"}]}, {"coding": [{"system": "http://snomed.info/sct", "code": "36653000", "display": "Rubella"}]}], "doseNumberString": "Dose sequence not recorded"}], "recorded": "2025-11-06", "identifier": [{"value": "InvalidInPDS_NhsNumber-20251106T125749", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "1980-11-01", "gender": "unknown", "address": [{"postalCode": "LS01 1AB"}], "name": [{"family": "test1", "given": ["test2"]}]}], "vaccineCode": {"coding": [{"system": "http://terminology.hl7.org/CodeSystem/v3-NullFlavor", "code": "NAVU", "display": "Not available"}]}, "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "170433008"}]}}], "occurrenceDateTime": "2025-11-06T12:56:59+00:00", "primarySource": true, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "148b43e8-27fa-4452-84f8-081331947a04"}', 'Version': Decimal('1'), 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#InvalidInPDS_NhsNumber-20251106T125749', 'PatientSK': 'MMR#148b43e8-27fa-4452-84f8-081331947a04', 'PK': 'Immunization#148b43e8-27fa-4452-84f8-081331947a04', 'PatientPK': 'Patient#TBC'}, 'ResponseMetadata': {'RequestId': 'PDE9Q8S610AFECHB5NV40IV8R7VV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Thu, 06 Nov 2025 12:58:43 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '2134', 'connection': 'keep-alive', 'x-amzn-requestid': 'PDE9Q8S610AFECHB5NV40IV8R7VV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '263968467'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Item': {'Operation': 'CREATE', 'SupplierSystem': 'MAVIS', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "14189004", "display": "Measles"}]}, {"coding": [{"system": "http://snomed.info/sct", "code": "36989005", "display": "Mumps"}]}, {"coding": [{"system": "http://snomed.info/sct", "code": "36653000", "display": "Rubella"}]}], "doseNumberString": "Dose sequence not recorded"}], "recorded": "2025-11-06", "identifier": [{"value": "SFlag_NhsNumber-20251106T125749", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "1980-11-01", "gender": "unknown", "address": [{"postalCode": "LS01 1AB"}], "name": [{"family": "test1", "given": ["test2"]}]}], "vaccineCode": {"coding": [{"system": "http://terminology.hl7.org/CodeSystem/v3-NullFlavor", "code": "NAVU", "display": "Not available"}]}, "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "170433008"}]}}], "occurrenceDateTime": "2025-11-06T12:56:59+00:00", "primarySource": true, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "0786305e-9a05-44e5-9389-7be76752116b"}', 'Version': Decimal('1'), 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#SFlag_NhsNumber-20251106T125749', 'PatientSK': 'MMR#0786305e-9a05-44e5-9389-7be76752116b', 'PK': 'Immunization#0786305e-9a05-44e5-9389-7be76752116b', 'PatientPK': 'Patient#TBC'}, 'ResponseMetadata': {'RequestId': 'EQDPHR1HA73889QQ4863DLG18JVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Thu, 06 Nov 2025 12:58:43 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '2120', 'connection': 'keep-alive', 'x-amzn-requestid': 'EQDPHR1HA73889QQ4863DLG18JVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '2667969820'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Item': {'Operation': 'CREATE', 'SupplierSystem': 'MAVIS', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "14189004", "display": "Measles"}]}, {"coding": [{"system": "http://snomed.info/sct", "code": "36989005", "display": "Mumps"}]}, {"coding": [{"system": "http://snomed.info/sct", "code": "36653000", "display": "Rubella"}]}], "doseNumberString": "Dose sequence not recorded"}], "recorded": "2025-11-06", "identifier": [{"value": "Mod11_NhSNumber-20251106T125749", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2007-11-25", "gender": "unknown", "address": [{"postalCode": "LS8 4HS"}], "name": [{"family": "STERLING", "given": ["Sall"]}]}], "vaccineCode": {"coding": [{"system": "http://terminology.hl7.org/CodeSystem/v3-NullFlavor", "code": "NAVU", "display": "Not available"}]}, "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "170433008"}]}}], "occurrenceDateTime": "2025-11-06T12:56:59+00:00", "primarySource": true, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "2ebfa301-f427-4a86-9e8d-141eefeb42a7"}', 'Version': Decimal('1'), 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Mod11_NhSNumber-20251106T125749', 'PatientSK': 'MMR#2ebfa301-f427-4a86-9e8d-141eefeb42a7', 'PK': 'Immunization#2ebfa301-f427-4a86-9e8d-141eefeb42a7', 'PatientPK': 'Patient#TBC'}, 'ResponseMetadata': {'RequestId': 'F4QP39AC22LJ3JE0OJ104TTB17VV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Thu, 06 Nov 2025 12:58:43 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '2121', 'connection': 'keep-alive', 'x-amzn-requestid': 'F4QP39AC22LJ3JE0OJ104TTB17VV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '3223446367'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Item': {'Operation': 'CREATE', 'SupplierSystem': 'MAVIS', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "14189004", "display": "Measles"}]}, {"coding": [{"system": "http://snomed.info/sct", "code": "36989005", "display": "Mumps"}]}, {"coding": [{"system": "http://snomed.info/sct", "code": "36653000", "display": "Rubella"}]}], "doseNumberString": "Dose sequence not recorded"}], "recorded": "2025-11-06", "identifier": [{"value": "OldNHSNo-20251106T125749", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "1980-11-01", "gender": "unknown", "address": [{"postalCode": "LS01 1AB"}], "name": [{"family": "test1", "given": ["test2"]}]}], "vaccineCode": {"coding": [{"system": "http://terminology.hl7.org/CodeSystem/v3-NullFlavor", "code": "NAVU", "display": "Not available"}]}, "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "38598009"}]}}], "occurrenceDateTime": "2025-11-06T12:56:59+00:00", "primarySource": true, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "4ca9fb06-2132-4e81-ac95-d9ca775ac8d7"}', 'Version': Decimal('1'), 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#OldNHSNo-20251106T125749', 'PatientSK': 'MMR#4ca9fb06-2132-4e81-ac95-d9ca775ac8d7', 'PK': 'Immunization#4ca9fb06-2132-4e81-ac95-d9ca775ac8d7', 'PatientPK': 'Patient#TBC'}, 'ResponseMetadata': {'RequestId': '1M2T5E78H8U674EM76KESLF99JVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Thu, 06 Nov 2025 12:58:44 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '2105', 'connection': 'keep-alive', 'x-amzn-requestid': '1M2T5E78H8U674EM76KESLF99JVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '1804737011'}, 'RetryAttempts': 0}} 

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=ceff2300-e744-4aaa-9071-f56bf442bf75

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=148b43e8-27fa-4452-84f8-081331947a04

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=0786305e-9a05-44e5-9389-7be76752116b

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=2ebfa301-f427-4a86-9e8d-141eefeb42a7

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=4ca9fb06-2132-4e81-ac95-d9ca775ac8d7

Sending DELETE request to: https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/ceff2300-e744-4aaa-9071-f56bf442bf75
Sending DELETE request to: https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/148b43e8-27fa-4452-84f8-081331947a04
Sending DELETE request to: https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/0786305e-9a05-44e5-9389-7be76752116b
Sending DELETE request to: https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/2ebfa301-f427-4a86-9e8d-141eefeb42a7
Sending DELETE request to: https://int.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/4ca9fb06-2132-4e81-ac95-d9ca775ac8d7
✅ All IMMS_IDs deleted successfully.
