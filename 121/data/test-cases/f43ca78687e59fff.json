{"uid":"f43ca78687e59fff","name":"Verify that VACCINATION PROCEDURE TERM, VACCINE PRODUCT TERM, SITE OF VACCINATION TERM, ROUTE OF VACCINATION TERM fields are mapped to coding.display in imms delta table in case of only one instance of coding","fullName":"features.APITests.steps.test_create_steps#test_verify_that_vaccination_procedure_term_vaccine_product_term_site_of_vaccination_term_route_of_vaccination_term_fields_are_mapped_to_codingdisplay_in_imms_delta_table_in_case_of_only_one_instance_of_coding","historyId":"5904ebac775d8ae8827d9c67c55abda0","time":{"start":1762170567926,"stop":1762170578955,"duration":11029},"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/create.feature: Verify that VACCINATION_PROCEDURE_TERM, VACCINE_PRODUCT_TERM, SITE_OF_VACCINATION_TERM, ROUTE_OF_VACCINATION_TERM fields are mapped to coding.display in imms delta table in case of only one instance of coding","descriptionHtml":"<p>/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/create.feature: Verify that VACCINATION_PROCEDURE_TERM, VACCINE_PRODUCT_TERM, SITE_OF_VACCINATION_TERM, ROUTE_OF_VACCINATION_TERM fields are mapped to coding.display in imms delta table in case of only one instance of coding</p>\n","status":"failed","statusMessage":"AssertionError: Expected status code 204, but got 404. Response: {'resourceType': 'OperationOutcome', 'id': '83f136b8-5405-43a8-97ef-7551181098b4', 'meta': {'profile': ['https://simplifier.net/guide/UKCoreDevelopment2/ProfileUKCore-OperationOutcome']}, 'issue': [{'severity': 'error', 'code': 'not-found', 'details': {'coding': [{'system': 'https://fhir.nhs.uk/Codesystem/http-error-codes', 'code': 'NOT-FOUND'}]}, 'diagnostics': 'Immunization resource does not exist. ID: None'}]}\nassert 404 == 204\n +  where 404 = <Response [404]>.status_code\n +    where <Response [404]> = <utilities.context.ScenarioContext object at 0x7fea14a337d0>.response","statusTrace":"fixturefunc = <function The_request_will_have_status_code at 0x7fea157985e0>\nrequest = <FixtureRequest for <Function test_verify_that_vaccination_procedure_term_vaccine_product_term_site_of_vaccination_ter...ute_of_vaccination_term_fields_are_mapped_to_codingdisplay_in_imms_delta_table_in_case_of_only_one_instance_of_coding>>\nkwargs = {'context': <utilities.context.ScenarioContext object at 0x7fea14a337d0>, 'statusCode': '201'}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7fea14a337d0>\nstatusCode = '201'\n\n    @then(parsers.parse(\"The request will be unsuccessful with the status code '{statusCode}'\"))\n    @then(parsers.parse(\"The request will be successful with the status code '{statusCode}'\"))\n    def The_request_will_have_status_code(context, statusCode):\n        print(context.response.status_code)\n        print(int(statusCode))\n>       assert context.response.status_code == int(statusCode), f\"\\n Expected status code: {statusCode}, but got: {context.response.status_code}. Response: {context.response.json()} \\n\"\nE       AssertionError: \nE        Expected status code: 201, but got: 502. Response: {'fault': {'faultstring': 'Unexpected EOF at target', 'detail': {'errorcode': 'messaging.adaptors.http.flow.UnexpectedEOFAtTarget'}}}\n\nfeatures/APITests/steps/common_steps.py:66: AssertionError\n\nDuring handling of the above exception, another exception occurred:\n\nself = <HookCaller 'pytest_bdd_after_scenario'>\nkwargs = {'feature': Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', ScenarioTem...)], description='', tags={'supplier_name_RAVS', 'patient_id_Random', 'vaccine_type_RSV', 'Delete_cleanUp'}, rule=None)}\nfirstresult = False\n\n    def __call__(self, **kwargs: object) -> Any:\n        \"\"\"Call the hook.\n    \n        Only accepts keyword arguments, which should match the hook\n        specification.\n    \n        Returns the result(s) of calling all registered plugins, see\n        :ref:`calling`.\n        \"\"\"\n        assert (\n            not self.is_historic()\n        ), \"Cannot directly call a historic hook - use call_historic instead.\"\n        self._verify_all_args_are_provided(kwargs)\n        firstresult = self.spec.opts.get(\"firstresult\", False) if self.spec else False\n        # Copy because plugins may register other plugins during iteration (#438).\n>       return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n\nvenv/lib/python3.11/site-packages/pluggy/_hooks.py:513: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.11/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nrequest = <FixtureRequest for <Function test_verify_that_vaccination_procedure_term_vaccine_product_term_site_of_vaccination_ter...ute_of_vaccination_term_fields_are_mapped_to_codingdisplay_in_imms_delta_table_in_case_of_only_one_instance_of_coding>>\nfeature = Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', ScenarioTemplate(featur...'Create the immunization event for a patient', tags={'Create_Feature'}, background=None, line_number=2, description='')\nscenario = Scenario(feature=Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', Scenar...e)], description='', tags={'supplier_name_RAVS', 'patient_id_Random', 'vaccine_type_RSV', 'Delete_cleanUp'}, rule=None)\n\n    def pytest_bdd_after_scenario(request, feature, scenario):\n        tags = set(getattr(scenario, 'tags', [])) | set(getattr(feature, 'tags', []))\n        context = request.getfixturevalue('context')\n        get_delete_url_header(context)\n    \n        if 'Delete_cleanUp' in tags:\n            print(f\"\\n Delete Request is {context.url}/{context.ImmsID}\")\n            context.response = requests.delete(f\"{context.url}/{context.ImmsID}\", headers=context.headers)\n>           assert context.response.status_code == 204, f\"Expected status code 204, but got {context.response.status_code}. Response: {context.response.json()}\"\nE           AssertionError: Expected status code 204, but got 404. Response: {'resourceType': 'OperationOutcome', 'id': '83f136b8-5405-43a8-97ef-7551181098b4', 'meta': {'profile': ['https://simplifier.net/guide/UKCoreDevelopment2/ProfileUKCore-OperationOutcome']}, 'issue': [{'severity': 'error', 'code': 'not-found', 'details': {'coding': [{'system': 'https://fhir.nhs.uk/Codesystem/http-error-codes', 'code': 'NOT-FOUND'}]}, 'diagnostics': 'Immunization resource does not exist. ID: None'}]}\nE           assert 404 == 204\nE            +  where 404 = <Response [404]>.status_code\nE            +    where <Response [404]> = <utilities.context.ScenarioContext object at 0x7fea14a337d0>.response\n\nfeatures/conftest.py:86: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup_environment","time":{"start":1762170504527,"stop":1762170504527,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"global_context","time":{"start":1762170504530,"stop":1762170506231,"duration":1701},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"_pytest_bdd_example","time":{"start":1762170567926,"stop":1762170567926,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"context","time":{"start":1762170567927,"stop":1762170570128,"duration":2201},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"testStage":{"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/create.feature: Verify that VACCINATION_PROCEDURE_TERM, VACCINE_PRODUCT_TERM, SITE_OF_VACCINATION_TERM, ROUTE_OF_VACCINATION_TERM fields are mapped to coding.display in imms delta table in case of only one instance of coding","status":"failed","statusMessage":"AssertionError: Expected status code 204, but got 404. Response: {'resourceType': 'OperationOutcome', 'id': '83f136b8-5405-43a8-97ef-7551181098b4', 'meta': {'profile': ['https://simplifier.net/guide/UKCoreDevelopment2/ProfileUKCore-OperationOutcome']}, 'issue': [{'severity': 'error', 'code': 'not-found', 'details': {'coding': [{'system': 'https://fhir.nhs.uk/Codesystem/http-error-codes', 'code': 'NOT-FOUND'}]}, 'diagnostics': 'Immunization resource does not exist. ID: None'}]}\nassert 404 == 204\n +  where 404 = <Response [404]>.status_code\n +    where <Response [404]> = <utilities.context.ScenarioContext object at 0x7fea14a337d0>.response","statusTrace":"fixturefunc = <function The_request_will_have_status_code at 0x7fea157985e0>\nrequest = <FixtureRequest for <Function test_verify_that_vaccination_procedure_term_vaccine_product_term_site_of_vaccination_ter...ute_of_vaccination_term_fields_are_mapped_to_codingdisplay_in_imms_delta_table_in_case_of_only_one_instance_of_coding>>\nkwargs = {'context': <utilities.context.ScenarioContext object at 0x7fea14a337d0>, 'statusCode': '201'}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7fea14a337d0>\nstatusCode = '201'\n\n    @then(parsers.parse(\"The request will be unsuccessful with the status code '{statusCode}'\"))\n    @then(parsers.parse(\"The request will be successful with the status code '{statusCode}'\"))\n    def The_request_will_have_status_code(context, statusCode):\n        print(context.response.status_code)\n        print(int(statusCode))\n>       assert context.response.status_code == int(statusCode), f\"\\n Expected status code: {statusCode}, but got: {context.response.status_code}. Response: {context.response.json()} \\n\"\nE       AssertionError: \nE        Expected status code: 201, but got: 502. Response: {'fault': {'faultstring': 'Unexpected EOF at target', 'detail': {'errorcode': 'messaging.adaptors.http.flow.UnexpectedEOFAtTarget'}}}\n\nfeatures/APITests/steps/common_steps.py:66: AssertionError\n\nDuring handling of the above exception, another exception occurred:\n\nself = <HookCaller 'pytest_bdd_after_scenario'>\nkwargs = {'feature': Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', ScenarioTem...)], description='', tags={'supplier_name_RAVS', 'patient_id_Random', 'vaccine_type_RSV', 'Delete_cleanUp'}, rule=None)}\nfirstresult = False\n\n    def __call__(self, **kwargs: object) -> Any:\n        \"\"\"Call the hook.\n    \n        Only accepts keyword arguments, which should match the hook\n        specification.\n    \n        Returns the result(s) of calling all registered plugins, see\n        :ref:`calling`.\n        \"\"\"\n        assert (\n            not self.is_historic()\n        ), \"Cannot directly call a historic hook - use call_historic instead.\"\n        self._verify_all_args_are_provided(kwargs)\n        firstresult = self.spec.opts.get(\"firstresult\", False) if self.spec else False\n        # Copy because plugins may register other plugins during iteration (#438).\n>       return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n\nvenv/lib/python3.11/site-packages/pluggy/_hooks.py:513: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.11/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nrequest = <FixtureRequest for <Function test_verify_that_vaccination_procedure_term_vaccine_product_term_site_of_vaccination_ter...ute_of_vaccination_term_fields_are_mapped_to_codingdisplay_in_imms_delta_table_in_case_of_only_one_instance_of_coding>>\nfeature = Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', ScenarioTemplate(featur...'Create the immunization event for a patient', tags={'Create_Feature'}, background=None, line_number=2, description='')\nscenario = Scenario(feature=Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', Scenar...e)], description='', tags={'supplier_name_RAVS', 'patient_id_Random', 'vaccine_type_RSV', 'Delete_cleanUp'}, rule=None)\n\n    def pytest_bdd_after_scenario(request, feature, scenario):\n        tags = set(getattr(scenario, 'tags', [])) | set(getattr(feature, 'tags', []))\n        context = request.getfixturevalue('context')\n        get_delete_url_header(context)\n    \n        if 'Delete_cleanUp' in tags:\n            print(f\"\\n Delete Request is {context.url}/{context.ImmsID}\")\n            context.response = requests.delete(f\"{context.url}/{context.ImmsID}\", headers=context.headers)\n>           assert context.response.status_code == 204, f\"Expected status code 204, but got {context.response.status_code}. Response: {context.response.json()}\"\nE           AssertionError: Expected status code 204, but got 404. Response: {'resourceType': 'OperationOutcome', 'id': '83f136b8-5405-43a8-97ef-7551181098b4', 'meta': {'profile': ['https://simplifier.net/guide/UKCoreDevelopment2/ProfileUKCore-OperationOutcome']}, 'issue': [{'severity': 'error', 'code': 'not-found', 'details': {'coding': [{'system': 'https://fhir.nhs.uk/Codesystem/http-error-codes', 'code': 'NOT-FOUND'}]}, 'diagnostics': 'Immunization resource does not exist. ID: None'}]}\nE           assert 404 == 204\nE            +  where 404 = <Response [404]>.status_code\nE            +    where <Response [404]> = <utilities.context.ScenarioContext object at 0x7fea14a337d0>.response\n\nfeatures/conftest.py:86: AssertionError","steps":[],"attachments":[{"uid":"2a796698209bbf68","name":"Step Passed: Valid json payload is created where vaccination terms has one instance of coding with no text or value string field","source":"2a796698209bbf68.txt","type":"text/plain","size":134},{"uid":"bd8c3ff568cda41e","name":"Step Passed: Trigger the post create request","source":"bd8c3ff568cda41e.txt","type":"text/plain","size":50},{"uid":"2c93eae1e0d69f66","name":"Step Failed: The request will be successful with the status code '201'","source":"2c93eae1e0d69f66.txt","type":"text/plain","size":276},{"uid":"436e3ec14158cec","name":"stdout","source":"436e3ec14158cec.txt","type":"text/plain","size":2946}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":4,"hasContent":true},"afterStages":[],"labels":[{"name":"epic","value":"Immunization Service"},{"name":"suite","value":"Create the immunization event for a patient"},{"name":"feature","value":"Create the immunization event for a patient"},{"name":"tag","value":"patient_id_Random"},{"name":"tag","value":"vaccine_type_RSV"},{"name":"tag","value":"supplier_name_RAVS"},{"name":"tag","value":"Delete_cleanUp"},{"name":"tag","value":"Create_Feature"},{"name":"parentSuite","value":"features.APITests.steps"},{"name":"host","value":"runnervmf2e7y"},{"name":"thread","value":"2463-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"features.APITests.steps.test_create_steps"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":19,"unknown":0,"total":20},"items":[{"uid":"281835f009a2802d","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/120//#testresult/281835f009a2802d","status":"passed","time":{"start":1762168114744,"stop":1762168118717,"duration":3973}},{"uid":"53ee6ea607efb0da","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/118//#testresult/53ee6ea607efb0da","status":"passed","time":{"start":1761836511529,"stop":1761836515331,"duration":3802}},{"uid":"698659a5c0bb8729","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/117//#testresult/698659a5c0bb8729","status":"passed","time":{"start":1761835536262,"stop":1761835539459,"duration":3197}},{"uid":"4be9fc331811d1ae","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/116//#testresult/4be9fc331811d1ae","status":"passed","time":{"start":1761832536186,"stop":1761832540048,"duration":3862}},{"uid":"39dd3bce581ed8b8","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/114//#testresult/39dd3bce581ed8b8","status":"passed","time":{"start":1761820031894,"stop":1761820036196,"duration":4302}},{"uid":"d19a96d399406468","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/113//#testresult/d19a96d399406468","status":"passed","time":{"start":1761724807415,"stop":1761724811789,"duration":4374}},{"uid":"3877b1568349d80f","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/112//#testresult/3877b1568349d80f","status":"passed","time":{"start":1761652583106,"stop":1761652586075,"duration":2969}},{"uid":"b0ab73f37aafc23e","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/111//#testresult/b0ab73f37aafc23e","status":"passed","time":{"start":1761651124398,"stop":1761651128693,"duration":4295}},{"uid":"ab282438963b4775","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/110//#testresult/ab282438963b4775","status":"passed","time":{"start":1761648186493,"stop":1761648190145,"duration":3652}},{"uid":"d8227f72aec3574","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/109//#testresult/d8227f72aec3574","status":"passed","time":{"start":1761644784656,"stop":1761644789648,"duration":4992}},{"uid":"32049754193ae6eb","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/108//#testresult/32049754193ae6eb","status":"passed","time":{"start":1761643446542,"stop":1761643450499,"duration":3957}},{"uid":"d38062382e558856","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/107//#testresult/d38062382e558856","status":"passed","time":{"start":1761574836552,"stop":1761574839524,"duration":2972}},{"uid":"1ccf1adece127ca6","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/105//#testresult/1ccf1adece127ca6","status":"passed","time":{"start":1761298263354,"stop":1761298266402,"duration":3048}},{"uid":"a15632bce1d2a188","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/104//#testresult/a15632bce1d2a188","status":"passed","time":{"start":1761296952275,"stop":1761296956338,"duration":4063}},{"uid":"ff5ede5cdb8eff33","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/103//#testresult/ff5ede5cdb8eff33","status":"passed","time":{"start":1761290482773,"stop":1761290486137,"duration":3364}},{"uid":"aea15940e484cd59","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/102//#testresult/aea15940e484cd59","status":"passed","time":{"start":1761227363574,"stop":1761227368540,"duration":4966}},{"uid":"c5171a4d5cf14103","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/101//#testresult/c5171a4d5cf14103","status":"passed","time":{"start":1761056232630,"stop":1761056237712,"duration":5082}},{"uid":"962bbd34e34e39cc","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/100//#testresult/962bbd34e34e39cc","status":"passed","time":{"start":1760976601277,"stop":1760976607375,"duration":6098}},{"uid":"94efde111ffbf4d","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/99//#testresult/94efde111ffbf4d","status":"passed","time":{"start":1760972832889,"stop":1760972835805,"duration":2916}}]},"tags":["Create_Feature","patient_id_Random","supplier_name_RAVS","vaccine_type_RSV","Delete_cleanUp"]},"source":"f43ca78687e59fff.json","parameterValues":[]}