{"uid":"2161d78051099472","name":"Verify that minimum dataset vaccination record will be created through batch file","fullName":"features.batchTests.Steps.test_create_batch_steps#test_verify_that_minimum_dataset_vaccination_record_will_be_created_through_batch_file","historyId":"a2ca749468eabcb18ccffad9519d20e5","time":{"start":1762168519682,"stop":1762168570883,"duration":51201},"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/batchTests/create_batch.feature: Verify that minimum dataset vaccination record will be created through batch file","descriptionHtml":"<p>/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/batchTests/create_batch.feature: Verify that minimum dataset vaccination record will be created through batch file</p>\n","status":"broken","statusMessage":"ValueError: could not convert string to float: ''","statusTrace":"fixturefunc = <function validate_imms_delta_table_for_all_records_in_batch_file at 0x7fe74e42a700>\nrequest = <FixtureRequest for <Function test_verify_that_minimum_dataset_vaccination_record_will_be_created_through_batch_file>>\nkwargs = {'context': <utilities.context.ScenarioContext object at 0x7fe74d946bd0>}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nfeatures/batchTests/Steps/batch_common_steps.py:133: in validate_imms_delta_table_for_all_records_in_batch_file\n    validate_imms_delta_record_with_batch_record(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7fe74d946bd0>\nbatch_record = {'ACTION_FLAG': 'NEW', 'BATCH_NUMBER': '', 'DATE_AND_TIME': '20251103T11143100', 'DOSE_AMOUNT': '', ...}\nitem = [{'DateTimeStamp': '2025-11-03T11:15:57+00:00', 'ExpiresAt': Decimal('1764760557'), 'Imms': {'ACTION_FLAG': 'NEW', 'BA...ERSION_ERRORS': [], 'DATE_AND_TIME': '20251103T11143100', ...}, 'ImmsID': 'de8a18b3-b4eb-4a62-b990-61967fbc3785', ...}]\nevent_type = 'CREATE', action_flag = 'NEW'\n\n    def validate_imms_delta_record_with_batch_record(context, batch_record, item, event_type, action_flag):\n        event = item[0].get(\"Imms\")\n        assert event, \"Imms field missing in items.\"\n    \n        fields_to_compare = [\n            (\"Operation\", event_type.upper(), item[0].get(\"Operation\")),\n            (\"SupplierSystem\", context.supplier_name.lower(), item[0].get(\"SupplierSystem\").lower()),\n            (\"VaccineType\", f\"{context.vaccine_type.lower()}\", item[0].get(\"VaccineType\").lower()),\n            (\"Source\", \"IEDS\", item[0].get(\"Source\")),\n            (\"CONVERSION_ERRORS\", [], event.get(\"CONVERSION_ERRORS\")),\n            (\"PERSON_FORENAME\", batch_record[\"PERSON_FORENAME\"], event.get(\"PERSON_FORENAME\")),\n            (\"PERSON_SURNAME\", batch_record[\"PERSON_SURNAME\"], event.get(\"PERSON_SURNAME\")),\n            (\"NHS_NUMBER\", batch_record[\"NHS_NUMBER\"], event.get(\"NHS_NUMBER\")),\n            (\"PERSON_DOB\", batch_record[\"PERSON_DOB\"], event.get(\"PERSON_DOB\")),\n            (\"PERSON_POSTCODE\", batch_record[\"PERSON_POSTCODE\"], event.get(\"PERSON_POSTCODE\")),\n            (\"PERSON_GENDER_CODE\", get_gender_code(batch_record[\"PERSON_GENDER_CODE\"]).value, event.get(\"PERSON_GENDER_CODE\")),\n            (\"VACCINATION_PROCEDURE_CODE\", batch_record[\"VACCINATION_PROCEDURE_CODE\"], event.get(\"VACCINATION_PROCEDURE_CODE\")),\n            (\"VACCINATION_PROCEDURE_TERM\", batch_record[\"VACCINATION_PROCEDURE_TERM\"], event.get(\"VACCINATION_PROCEDURE_TERM\")),\n            (\"VACCINE_PRODUCT_TERM\", batch_record[\"VACCINE_PRODUCT_TERM\"], event.get(\"VACCINE_PRODUCT_TERM\")),\n            (\"VACCINE_PRODUCT_CODE\", batch_record[\"VACCINE_PRODUCT_CODE\"], event.get(\"VACCINE_PRODUCT_CODE\")),\n            (\"VACCINE_MANUFACTURER\", batch_record[\"VACCINE_MANUFACTURER\"] , event.get(\"VACCINE_MANUFACTURER\")),\n            (\"BATCH_NUMBER\", batch_record[\"BATCH_NUMBER\"], event.get(\"BATCH_NUMBER\")),\n            (\"RECORDED_DATE\", batch_record[\"RECORDED_DATE\"], event.get(\"RECORDED_DATE\")),\n            (\"EXPIRY_DATE\", batch_record[\"EXPIRY_DATE\"], event.get(\"EXPIRY_DATE\")),\n            (\"DOSE_SEQUENCE\", batch_record[\"DOSE_SEQUENCE\"], event.get(\"DOSE_SEQUENCE\")),\n            (\"DOSE_UNIT_TERM\", batch_record[\"DOSE_UNIT_TERM\"] , event.get(\"DOSE_UNIT_TERM\")),\n            (\"DOSE_UNIT_CODE\", batch_record[\"DOSE_UNIT_CODE\"], event.get(\"DOSE_UNIT_CODE\")),\n            (\"SITE_OF_VACCINATION_TERM\", batch_record[\"SITE_OF_VACCINATION_TERM\"], event.get(\"SITE_OF_VACCINATION_TERM\")),\n            (\"SITE_OF_VACCINATION_CODE\", batch_record[\"SITE_OF_VACCINATION_CODE\"], event.get(\"SITE_OF_VACCINATION_CODE\")),\n>           (\"DOSE_AMOUNT\", float(batch_record[\"DOSE_AMOUNT\"]) , float(event.get(\"DOSE_AMOUNT\"))),\n            (\"PRIMARY_SOURCE\", str(batch_record[\"PRIMARY_SOURCE\"]).upper(), event.get(\"PRIMARY_SOURCE\")),\n            (\"ROUTE_OF_VACCINATION_TERM\", batch_record[\"ROUTE_OF_VACCINATION_TERM\"], event.get(\"ROUTE_OF_VACCINATION_TERM\")),\n            (\"ROUTE_OF_VACCINATION_CODE\", batch_record[\"ROUTE_OF_VACCINATION_CODE\"], event.get(\"ROUTE_OF_VACCINATION_CODE\")),\n            (\"ACTION_FLAG\", action_flag, event.get(\"ACTION_FLAG\")),\n            (\"DATE_AND_TIME\", batch_record[\"DATE_AND_TIME\"], event.get(\"DATE_AND_TIME\")),\n            (\"UNIQUE_ID\", batch_record[\"UNIQUE_ID\"], event.get(\"UNIQUE_ID\")),\n            (\"UNIQUE_ID_URI\", batch_record[\"UNIQUE_ID_URI\"], event.get(\"UNIQUE_ID_URI\")),\n            (\"PERFORMING_PROFESSIONAL_SURNAME\", batch_record[\"PERFORMING_PROFESSIONAL_SURNAME\"], event.get(\"PERFORMING_PROFESSIONAL_SURNAME\")),\n            (\"PERFORMING_PROFESSIONAL_FORENAME\", batch_record[\"PERFORMING_PROFESSIONAL_FORENAME\"], event.get(\"PERFORMING_PROFESSIONAL_FORENAME\")),\n            (\"LOCATION_CODE\", batch_record[\"LOCATION_CODE\"], event.get(\"LOCATION_CODE\")),\n            (\"LOCATION_CODE_TYPE_URI\", batch_record[\"LOCATION_CODE_TYPE_URI\"], event.get(\"LOCATION_CODE_TYPE_URI\")),\n            (\"SITE_CODE_TYPE_URI\", batch_record[\"SITE_CODE_TYPE_URI\"], event.get(\"SITE_CODE_TYPE_URI\")),\n            (\"SITE_CODE\", batch_record[\"SITE_CODE\"], event.get(\"SITE_CODE\")),\n            (\"INDICATION_CODE\", batch_record[\"INDICATION_CODE\"] , event.get(\"INDICATION_CODE\")),\n        ]\nE       ValueError: could not convert string to float: ''\n\nsrc/dynamoDB/dynamo_db_helper.py:305: ValueError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup_environment","time":{"start":1762168076668,"stop":1762168076668,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"global_context","time":{"start":1762168076670,"stop":1762168078269,"duration":1599},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"_pytest_bdd_example","time":{"start":1762168519682,"stop":1762168519682,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"context","time":{"start":1762168519683,"stop":1762168521127,"duration":1444},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"testStage":{"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/batchTests/create_batch.feature: Verify that minimum dataset vaccination record will be created through batch file","status":"broken","statusMessage":"ValueError: could not convert string to float: ''","statusTrace":"fixturefunc = <function validate_imms_delta_table_for_all_records_in_batch_file at 0x7fe74e42a700>\nrequest = <FixtureRequest for <Function test_verify_that_minimum_dataset_vaccination_record_will_be_created_through_batch_file>>\nkwargs = {'context': <utilities.context.ScenarioContext object at 0x7fe74d946bd0>}\n\n    def call_fixture_func(\n        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs\n    ) -> FixtureValue:\n        if is_generator(fixturefunc):\n            fixturefunc = cast(\n                Callable[..., Generator[FixtureValue, None, None]], fixturefunc\n            )\n            generator = fixturefunc(**kwargs)\n            try:\n                fixture_result = next(generator)\n            except StopIteration:\n                raise ValueError(f\"{request.fixturename} did not yield a value\") from None\n            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)\n            request.addfinalizer(finalizer)\n        else:\n            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)\n>           fixture_result = fixturefunc(**kwargs)\n\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nfeatures/batchTests/Steps/batch_common_steps.py:133: in validate_imms_delta_table_for_all_records_in_batch_file\n    validate_imms_delta_record_with_batch_record(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7fe74d946bd0>\nbatch_record = {'ACTION_FLAG': 'NEW', 'BATCH_NUMBER': '', 'DATE_AND_TIME': '20251103T11143100', 'DOSE_AMOUNT': '', ...}\nitem = [{'DateTimeStamp': '2025-11-03T11:15:57+00:00', 'ExpiresAt': Decimal('1764760557'), 'Imms': {'ACTION_FLAG': 'NEW', 'BA...ERSION_ERRORS': [], 'DATE_AND_TIME': '20251103T11143100', ...}, 'ImmsID': 'de8a18b3-b4eb-4a62-b990-61967fbc3785', ...}]\nevent_type = 'CREATE', action_flag = 'NEW'\n\n    def validate_imms_delta_record_with_batch_record(context, batch_record, item, event_type, action_flag):\n        event = item[0].get(\"Imms\")\n        assert event, \"Imms field missing in items.\"\n    \n        fields_to_compare = [\n            (\"Operation\", event_type.upper(), item[0].get(\"Operation\")),\n            (\"SupplierSystem\", context.supplier_name.lower(), item[0].get(\"SupplierSystem\").lower()),\n            (\"VaccineType\", f\"{context.vaccine_type.lower()}\", item[0].get(\"VaccineType\").lower()),\n            (\"Source\", \"IEDS\", item[0].get(\"Source\")),\n            (\"CONVERSION_ERRORS\", [], event.get(\"CONVERSION_ERRORS\")),\n            (\"PERSON_FORENAME\", batch_record[\"PERSON_FORENAME\"], event.get(\"PERSON_FORENAME\")),\n            (\"PERSON_SURNAME\", batch_record[\"PERSON_SURNAME\"], event.get(\"PERSON_SURNAME\")),\n            (\"NHS_NUMBER\", batch_record[\"NHS_NUMBER\"], event.get(\"NHS_NUMBER\")),\n            (\"PERSON_DOB\", batch_record[\"PERSON_DOB\"], event.get(\"PERSON_DOB\")),\n            (\"PERSON_POSTCODE\", batch_record[\"PERSON_POSTCODE\"], event.get(\"PERSON_POSTCODE\")),\n            (\"PERSON_GENDER_CODE\", get_gender_code(batch_record[\"PERSON_GENDER_CODE\"]).value, event.get(\"PERSON_GENDER_CODE\")),\n            (\"VACCINATION_PROCEDURE_CODE\", batch_record[\"VACCINATION_PROCEDURE_CODE\"], event.get(\"VACCINATION_PROCEDURE_CODE\")),\n            (\"VACCINATION_PROCEDURE_TERM\", batch_record[\"VACCINATION_PROCEDURE_TERM\"], event.get(\"VACCINATION_PROCEDURE_TERM\")),\n            (\"VACCINE_PRODUCT_TERM\", batch_record[\"VACCINE_PRODUCT_TERM\"], event.get(\"VACCINE_PRODUCT_TERM\")),\n            (\"VACCINE_PRODUCT_CODE\", batch_record[\"VACCINE_PRODUCT_CODE\"], event.get(\"VACCINE_PRODUCT_CODE\")),\n            (\"VACCINE_MANUFACTURER\", batch_record[\"VACCINE_MANUFACTURER\"] , event.get(\"VACCINE_MANUFACTURER\")),\n            (\"BATCH_NUMBER\", batch_record[\"BATCH_NUMBER\"], event.get(\"BATCH_NUMBER\")),\n            (\"RECORDED_DATE\", batch_record[\"RECORDED_DATE\"], event.get(\"RECORDED_DATE\")),\n            (\"EXPIRY_DATE\", batch_record[\"EXPIRY_DATE\"], event.get(\"EXPIRY_DATE\")),\n            (\"DOSE_SEQUENCE\", batch_record[\"DOSE_SEQUENCE\"], event.get(\"DOSE_SEQUENCE\")),\n            (\"DOSE_UNIT_TERM\", batch_record[\"DOSE_UNIT_TERM\"] , event.get(\"DOSE_UNIT_TERM\")),\n            (\"DOSE_UNIT_CODE\", batch_record[\"DOSE_UNIT_CODE\"], event.get(\"DOSE_UNIT_CODE\")),\n            (\"SITE_OF_VACCINATION_TERM\", batch_record[\"SITE_OF_VACCINATION_TERM\"], event.get(\"SITE_OF_VACCINATION_TERM\")),\n            (\"SITE_OF_VACCINATION_CODE\", batch_record[\"SITE_OF_VACCINATION_CODE\"], event.get(\"SITE_OF_VACCINATION_CODE\")),\n>           (\"DOSE_AMOUNT\", float(batch_record[\"DOSE_AMOUNT\"]) , float(event.get(\"DOSE_AMOUNT\"))),\n            (\"PRIMARY_SOURCE\", str(batch_record[\"PRIMARY_SOURCE\"]).upper(), event.get(\"PRIMARY_SOURCE\")),\n            (\"ROUTE_OF_VACCINATION_TERM\", batch_record[\"ROUTE_OF_VACCINATION_TERM\"], event.get(\"ROUTE_OF_VACCINATION_TERM\")),\n            (\"ROUTE_OF_VACCINATION_CODE\", batch_record[\"ROUTE_OF_VACCINATION_CODE\"], event.get(\"ROUTE_OF_VACCINATION_CODE\")),\n            (\"ACTION_FLAG\", action_flag, event.get(\"ACTION_FLAG\")),\n            (\"DATE_AND_TIME\", batch_record[\"DATE_AND_TIME\"], event.get(\"DATE_AND_TIME\")),\n            (\"UNIQUE_ID\", batch_record[\"UNIQUE_ID\"], event.get(\"UNIQUE_ID\")),\n            (\"UNIQUE_ID_URI\", batch_record[\"UNIQUE_ID_URI\"], event.get(\"UNIQUE_ID_URI\")),\n            (\"PERFORMING_PROFESSIONAL_SURNAME\", batch_record[\"PERFORMING_PROFESSIONAL_SURNAME\"], event.get(\"PERFORMING_PROFESSIONAL_SURNAME\")),\n            (\"PERFORMING_PROFESSIONAL_FORENAME\", batch_record[\"PERFORMING_PROFESSIONAL_FORENAME\"], event.get(\"PERFORMING_PROFESSIONAL_FORENAME\")),\n            (\"LOCATION_CODE\", batch_record[\"LOCATION_CODE\"], event.get(\"LOCATION_CODE\")),\n            (\"LOCATION_CODE_TYPE_URI\", batch_record[\"LOCATION_CODE_TYPE_URI\"], event.get(\"LOCATION_CODE_TYPE_URI\")),\n            (\"SITE_CODE_TYPE_URI\", batch_record[\"SITE_CODE_TYPE_URI\"], event.get(\"SITE_CODE_TYPE_URI\")),\n            (\"SITE_CODE\", batch_record[\"SITE_CODE\"], event.get(\"SITE_CODE\")),\n            (\"INDICATION_CODE\", batch_record[\"INDICATION_CODE\"] , event.get(\"INDICATION_CODE\")),\n        ]\nE       ValueError: could not convert string to float: ''\n\nsrc/dynamoDB/dynamo_db_helper.py:305: ValueError","steps":[],"attachments":[{"uid":"8b5e7d31bda6a164","name":"Step Passed: batch file is created for below data as minimum dataset","source":"8b5e7d31bda6a164.txt","type":"text/plain","size":74},{"uid":"ab2f9c45d4c9db5e","name":"Step Passed: batch file is uploaded in s3 bucket","source":"ab2f9c45d4c9db5e.txt","type":"text/plain","size":54},{"uid":"565e1a1f7398c87a","name":"Step Passed: file will be moved to destination bucket and inf ack file will be created","source":"565e1a1f7398c87a.txt","type":"text/plain","size":92},{"uid":"526e742a9f1d8b52","name":"Step Passed: inf ack file has success status for processed batch file","source":"526e742a9f1d8b52.txt","type":"text/plain","size":75},{"uid":"aa0805025d19a1f6","name":"Step Passed: bus ack file will be created","source":"aa0805025d19a1f6.txt","type":"text/plain","size":47},{"uid":"2127bad92314b929","name":"Step Passed: all records are processed successfully in the bus ack file","source":"2127bad92314b929.txt","type":"text/plain","size":77},{"uid":"1ac4328cedef4abc","name":"Step Passed: Audit table will have correct status, queue name and record count for the processed batch file","source":"1ac4328cedef4abc.txt","type":"text/plain","size":113},{"uid":"1f806c600c889720","name":"Step Passed: The imms event table will be populated with the correct data for 'created' event for records in batch file","source":"1f806c600c889720.txt","type":"text/plain","size":125},{"uid":"616ee3ddfebed26c","name":"Step Failed: The delta table will be populated with the correct data for all records in batch file","source":"616ee3ddfebed26c.txt","type":"text/plain","size":153},{"uid":"2ae9e00521774344","name":"stdout","source":"2ae9e00521774344.txt","type":"text/plain","size":15127}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":10,"hasContent":true},"afterStages":[],"labels":[{"name":"epic","value":"Immunization Service"},{"name":"suite","value":"Create the immunization event for a patient through batch file"},{"name":"feature","value":"Create the immunization event for a patient through batch file"},{"name":"tag","value":"vaccine_type_MMR"},{"name":"tag","value":"delete_cleanup_batch"},{"name":"tag","value":"supplier_name_MAVIS"},{"name":"tag","value":"Create_Batch_Feature"},{"name":"parentSuite","value":"features.batchTests.Steps"},{"name":"host","value":"runnervmf2e7y"},{"name":"thread","value":"2459-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"features.batchTests.Steps.test_create_batch_steps"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["vaccine_type_MMR","delete_cleanup_batch","Create_Batch_Feature","supplier_name_MAVIS"]},"source":"2161d78051099472.json","parameterValues":[]}