✅ Pipe-delimited file saved to: /home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/batch_files_directory/MENACWY_Vaccinations_v5_YGA_20251222T15334200.csv
Batch file created: MENACWY_Vaccinations_v5_YGA_20251222T15334200.csv
Upload successful: MENACWY_Vaccinations_v5_YGA_20251222T15334200.csv → immunisation-batch-internal-qa-data-sources
Batch file uploaded to S3: MENACWY_Vaccinations_v5_YGA_20251222T15334200.csv
Waiting for file in archive: s3://immunisation-batch-internal-qa-data-sources/archive/MENACWY_Vaccinations_v5_YGA_20251222T15334200.csv
Still waiting... (0s)
Still waiting... (5s)
Still waiting... (10s)
Still waiting... (15s)
Still waiting... (20s)
Still waiting... (25s)
Still waiting... (30s)
Still waiting... (35s)
Still waiting... (40s)
Still waiting... (45s)
File found in archive: archive/MENACWY_Vaccinations_v5_YGA_20251222T15334200.csv
Waiting for file starting with 'ack/MENACWY_Vaccinations_v5_YGA_20251222T15334200' in bucket: immunisation-batch-internal-qa-data-destinations
[FOUND] File located: ack/MENACWY_Vaccinations_v5_YGA_20251222T15334200_InfAck_20251222T15334300.csv
[SUCCESS] File contents loaded (299 bytes)
Waiting for file starting with 'forwardedFile/MENACWY_Vaccinations_v5_YGA_20251222T15334200' in bucket: immunisation-batch-internal-qa-data-destinations
[FOUND] File located: forwardedFile/MENACWY_Vaccinations_v5_YGA_20251222T15334200_BusAck_20251222T15334300.csv
[SUCCESS] File contents loaded (208 bytes)
No rows found in BUS ACK file for successful records
Attempt 1: Found 1 items

Found Audit detail for filename=MENACWY_Vaccinations_v5_YGA_20251222T15334200.csv


 Imms Event response is {'Items': [{'Version': Decimal('1'), 'SupplierSystem': 'TPP', 'PatientPK': 'Patient#9000194970', 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Action_flag_NEW-20251222T153342', 'Operation': 'CREATE', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "23511006", "display": "Meningococcal infectious disease"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2025-12-22", "identifier": [{"value": "Action_flag_NEW-20251222T153342", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2009-03-25", "gender": "male", "address": [{"postalCode": "N8 7RE"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9000194970"}], "name": [{"family": "REBBECCA", "given": ["FRIESEN"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "17188711000001105", "display": "Menveo vaccine powder and solvent for solution for injection 0.5ml vials (Novartis Vaccines and Diagnostics Ltd) (product)"}]}, "manufacturer": {"display": "Novartis Vaccines and Diagnostics Ltd"}, "expirationDate": "2025-12-22", "lotNumber": "909353", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "871874000", "display": "Administration of vaccine product containing only Neisseria meningitidis serogroup A, C, W135 and Y antigens (procedure)"}]}}], "occurrenceDateTime": "2025-12-22T15:32:52+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368209003", "display": "Right upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "34206005", "display": "Subcutaneous route (qualifier value)"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "6bd218b3-e3bc-4ada-9a9a-4c17b25bf3f1"}', 'PK': 'Immunization#6bd218b3-e3bc-4ada-9a9a-4c17b25bf3f1', 'PatientSK': 'MENACWY#6bd218b3-e3bc-4ada-9a9a-4c17b25bf3f1'}], 'Count': 1, 'ScannedCount': 1, 'ResponseMetadata': {'RequestId': 'V6OKDOKAG1631NI8DUG8HHJ4SFVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Mon, 22 Dec 2025 15:34:35 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '3102', 'connection': 'keep-alive', 'x-amzn-requestid': 'V6OKDOKAG1631NI8DUG8HHJ4SFVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '2070362926'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Items': [{'PatientPK': 'Patient#9470076362', 'PatientSK': 'MENACWY#221426b5-4f04-4825-b0a2-e461fc99727e', 'Operation': 'CREATE', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "23511006", "display": "Meningococcal infectious disease"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2025-12-22", "identifier": [{"value": "Action_flag_New-20251222T153342", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2006-07-17", "gender": "female", "address": [{"postalCode": "LA22 0HN"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9470076362"}], "name": [{"family": "CARIS", "given": ["FELTWELL"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "20517811000001104", "display": "Nimenrix vaccine powder and solvent for solution for injection 0.5ml pre-filled syringes (GlaxoSmithKline UK Ltd) (product)"}]}, "manufacturer": {"display": "GlaxoSmithKline UK Ltd"}, "expirationDate": "2025-12-22", "lotNumber": "114159", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "871874000", "display": "Administration of vaccine product containing only Neisseria meningitidis serogroup A, C, W135 and Y antigens (procedure)"}]}}], "occurrenceDateTime": "2025-12-22T15:32:52+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368208006", "display": "Left upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "34206005", "display": "Subcutaneous route (qualifier value)"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "221426b5-4f04-4825-b0a2-e461fc99727e"}', 'Version': Decimal('1'), 'PK': 'Immunization#221426b5-4f04-4825-b0a2-e461fc99727e', 'SupplierSystem': 'TPP', 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Action_flag_New-20251222T153342'}], 'Count': 1, 'ScannedCount': 1, 'ResponseMetadata': {'RequestId': 'ROU7N3VL6TF175003DPFJ3012FVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Mon, 22 Dec 2025 15:34:35 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '3089', 'connection': 'keep-alive', 'x-amzn-requestid': 'ROU7N3VL6TF175003DPFJ3012FVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '759097328'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Items': [{'PatientSK': 'MENACWY#f55a35d9-9817-4844-a762-a49dd7833475', 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Action_flag_new-20251222T153342', 'Operation': 'CREATE', 'Version': Decimal('1'), 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "23511006", "display": "Meningococcal infectious disease"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2025-12-22", "identifier": [{"value": "Action_flag_new-20251222T153342", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2009-09-23", "gender": "unknown", "address": [{"postalCode": "LA15 8SR"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9490423343"}], "name": [{"family": "ZHI", "given": ["OU"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "39779611000001104", "display": "MenQuadfi vaccine solution for injection 0.5ml vials (Sanofi) (product)"}]}, "manufacturer": {"display": "Sanofi"}, "expirationDate": "2025-12-22", "lotNumber": "119230", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "871874000", "display": "Administration of vaccine product containing only Neisseria meningitidis serogroup A, C, W135 and Y antigens (procedure)"}]}}], "occurrenceDateTime": "2025-12-22T15:32:52+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368209003", "display": "Right upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "78421000", "display": "Intramuscular"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "f55a35d9-9817-4844-a762-a49dd7833475"}', 'PatientPK': 'Patient#9490423343', 'SupplierSystem': 'TPP', 'PK': 'Immunization#f55a35d9-9817-4844-a762-a49dd7833475'}], 'Count': 1, 'ScannedCount': 1, 'ResponseMetadata': {'RequestId': '5RO2VUHSMOPMCPSDHCPP551D1FVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Mon, 22 Dec 2025 15:34:36 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '2992', 'connection': 'keep-alive', 'x-amzn-requestid': '5RO2VUHSMOPMCPSDHCPP551D1FVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '3666411958'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Items': [{'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "23511006", "display": "Meningococcal infectious disease"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2025-12-22", "identifier": [{"value": "Action_flag_nEw-20251222T153342", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2003-10-24", "gender": "unknown", "address": [{"postalCode": "NE16 5PH"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9459953654"}], "name": [{"family": "LUCASTA", "given": ["MEHMET-EMIN"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "20517811000001104", "display": "Nimenrix vaccine powder and solvent for solution for injection 0.5ml pre-filled syringes (GlaxoSmithKline UK Ltd) (product)"}]}, "manufacturer": {"display": "GlaxoSmithKline UK Ltd"}, "expirationDate": "2025-12-22", "lotNumber": "431663", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "871874000", "display": "Administration of vaccine product containing only Neisseria meningitidis serogroup A, C, W135 and Y antigens (procedure)"}]}}], "occurrenceDateTime": "2025-12-22T15:32:52+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368208006", "display": "Left upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "34206005", "display": "Subcutaneous route (qualifier value)"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "c60b828a-8c0a-4025-8e39-7673b9fd81e8"}', 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Action_flag_nEw-20251222T153342', 'PatientPK': 'Patient#9459953654', 'PatientSK': 'MENACWY#c60b828a-8c0a-4025-8e39-7673b9fd81e8', 'SupplierSystem': 'TPP', 'Operation': 'CREATE', 'Version': Decimal('1'), 'PK': 'Immunization#c60b828a-8c0a-4025-8e39-7673b9fd81e8'}], 'Count': 1, 'ScannedCount': 1, 'ResponseMetadata': {'RequestId': 'HA7QDTUEVHAGU61UPFK59IJ1UBVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Mon, 22 Dec 2025 15:34:36 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '3095', 'connection': 'keep-alive', 'x-amzn-requestid': 'HA7QDTUEVHAGU61UPFK59IJ1UBVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '3091138963'}, 'RetryAttempts': 0}} 

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=221426b5-4f04-4825-b0a2-e461fc99727e

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=6bd218b3-e3bc-4ada-9a9a-4c17b25bf3f1

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=c60b828a-8c0a-4025-8e39-7673b9fd81e8

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=f55a35d9-9817-4844-a762-a49dd7833475

Sending DELETE request to: https://internal-qa.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/6bd218b3-e3bc-4ada-9a9a-4c17b25bf3f1
Sending DELETE request to: https://internal-qa.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/221426b5-4f04-4825-b0a2-e461fc99727e
Sending DELETE request to: https://internal-qa.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/f55a35d9-9817-4844-a762-a49dd7833475
Sending DELETE request to: https://internal-qa.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/c60b828a-8c0a-4025-8e39-7673b9fd81e8
✅ All IMMS_IDs deleted successfully.
