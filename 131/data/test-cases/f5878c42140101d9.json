{"uid":"f5878c42140101d9","name":"Verify that the POST Create API will fail if recorded has future or invalid formatted date","fullName":"features.APITests.steps.test_create_steps#test_verify_that_the_post_create_api_will_fail_if_recorded_has_future_or_invalid_formatted_date","historyId":"f5ad2a554169af03fbb11fc174403277","time":{"start":1762342903640,"stop":1762342904414,"duration":774},"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/create.feature: Verify that the POST Create API will fail if recorded has future or invalid formatted date","descriptionHtml":"<p>/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/create.feature: Verify that the POST Create API will fail if recorded has future or invalid formatted date</p>\n","status":"failed","statusMessage":"AssertionError: <html>\r\n<head><title>403 Forbidden</title></head>\r\n<body>\r\n<center><h1>403 Forbidden</h1></center>\r\n</body>\r\n</html>","statusTrace":"self = <HookCaller 'pytest_bdd_after_scenario'>\nkwargs = {'feature': Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', ScenarioTem...round=None)], description='', tags={'supplier_name_Postman_Auth', 'vaccine_type_RSV', 'patient_id_Random'}, rule=None)}\nfirstresult = False\n\n    def __call__(self, **kwargs: object) -> Any:\n        \"\"\"Call the hook.\n    \n        Only accepts keyword arguments, which should match the hook\n        specification.\n    \n        Returns the result(s) of calling all registered plugins, see\n        :ref:`calling`.\n        \"\"\"\n        assert (\n            not self.is_historic()\n        ), \"Cannot directly call a historic hook - use call_historic instead.\"\n        self._verify_all_args_are_provided(kwargs)\n        firstresult = self.spec.opts.get(\"firstresult\", False) if self.spec else False\n        # Copy because plugins may register other plugins during iteration (#438).\n>       return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n\nvenv/lib/python3.11/site-packages/pluggy/_hooks.py:513: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.11/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\nfeatures/conftest.py:80: in pytest_bdd_after_scenario\n    context = request.getfixturevalue('context')\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:532: in getfixturevalue\n    fixturedef = self._get_active_fixturedef(argname)\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:617: in _get_active_fixturedef\n    fixturedef.execute(request=subrequest)\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:1071: in execute\n    raise exc.with_traceback(exc_tb)\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:1140: in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: in call_fixture_func\n    fixture_result = fixturefunc(**kwargs)\nfeatures/conftest.py:72: in context\n    get_tokens(ctx, ctx.supplier_name)\nutilities/api_gen_token.py:89: in get_tokens\n    context.token = get_access_token(context)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7f6844753910>\n\n    def get_access_token(context):\n        login_session = requests.session()\n        client_id = context.auth_client_Id\n        client_secret = context.auth_client_Secret\n        callback_url = context.callback_url\n        username = context.username\n        auth_url = context.auth_url\n        token_url = context.token_url\n        scope = context.scope\n    \n        #Login Page\n        authorize_resp = login_session.get(\n            auth_url,\n            params={\n                \"client_id\": client_id,\n                \"redirect_uri\": callback_url,\n                \"response_type\": \"code\",\n                \"scope\": scope,\n                \"state\": str(uuid.uuid4()),\n            },\n        )\n        assert authorize_resp.status_code == 200, authorize_resp.text\n    \n        #Submit the login form\n        tree = html.fromstring(authorize_resp.content.decode())\n        auth_form = tree.forms[0]\n        form_url = auth_form.action\n        form_data = {\"username\": username}\n        code_resp = login_session.post(url=form_url, data=form_data)\n>       assert code_resp.status_code == 200, code_resp.text\nE       AssertionError: <html>\r\nE       <head><title>403 Forbidden</title></head>\r\nE       <body>\r\nE       <center><h1>403 Forbidden</h1></center>\r\nE       </body>\r\nE       </html>\n\nutilities/api_gen_token.py:46: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup_environment","time":{"start":1762342820852,"stop":1762342820853,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_context","time":{"start":1762342820855,"stop":1762342822366,"duration":1511},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pytest_bdd_example","time":{"start":1762342934747,"stop":1762342934747,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"/home/runner/work/imms_fhir_api_automation/imms_fhir_api_automation/features/APITests/create.feature: Verify that the POST Create API will fail if recorded has future or invalid formatted date","status":"failed","statusMessage":"AssertionError: <html>\r\n<head><title>403 Forbidden</title></head>\r\n<body>\r\n<center><h1>403 Forbidden</h1></center>\r\n</body>\r\n</html>","statusTrace":"self = <HookCaller 'pytest_bdd_after_scenario'>\nkwargs = {'feature': Feature(scenarios=OrderedDict([('Verify that the POST Create API for different vaccine types', ScenarioTem...round=None)], description='', tags={'supplier_name_Postman_Auth', 'vaccine_type_RSV', 'patient_id_Random'}, rule=None)}\nfirstresult = False\n\n    def __call__(self, **kwargs: object) -> Any:\n        \"\"\"Call the hook.\n    \n        Only accepts keyword arguments, which should match the hook\n        specification.\n    \n        Returns the result(s) of calling all registered plugins, see\n        :ref:`calling`.\n        \"\"\"\n        assert (\n            not self.is_historic()\n        ), \"Cannot directly call a historic hook - use call_historic instead.\"\n        self._verify_all_args_are_provided(kwargs)\n        firstresult = self.spec.opts.get(\"firstresult\", False) if self.spec else False\n        # Copy because plugins may register other plugins during iteration (#438).\n>       return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n\nvenv/lib/python3.11/site-packages/pluggy/_hooks.py:513: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.11/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\nfeatures/conftest.py:80: in pytest_bdd_after_scenario\n    context = request.getfixturevalue('context')\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:532: in getfixturevalue\n    fixturedef = self._get_active_fixturedef(argname)\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:617: in _get_active_fixturedef\n    fixturedef.execute(request=subrequest)\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:1071: in execute\n    raise exc.with_traceback(exc_tb)\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:1140: in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\nvenv/lib/python3.11/site-packages/_pytest/fixtures.py:898: in call_fixture_func\n    fixture_result = fixturefunc(**kwargs)\nfeatures/conftest.py:72: in context\n    get_tokens(ctx, ctx.supplier_name)\nutilities/api_gen_token.py:89: in get_tokens\n    context.token = get_access_token(context)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7f6844753910>\n\n    def get_access_token(context):\n        login_session = requests.session()\n        client_id = context.auth_client_Id\n        client_secret = context.auth_client_Secret\n        callback_url = context.callback_url\n        username = context.username\n        auth_url = context.auth_url\n        token_url = context.token_url\n        scope = context.scope\n    \n        #Login Page\n        authorize_resp = login_session.get(\n            auth_url,\n            params={\n                \"client_id\": client_id,\n                \"redirect_uri\": callback_url,\n                \"response_type\": \"code\",\n                \"scope\": scope,\n                \"state\": str(uuid.uuid4()),\n            },\n        )\n        assert authorize_resp.status_code == 200, authorize_resp.text\n    \n        #Submit the login form\n        tree = html.fromstring(authorize_resp.content.decode())\n        auth_form = tree.forms[0]\n        form_url = auth_form.action\n        form_data = {\"username\": username}\n        code_resp = login_session.post(url=form_url, data=form_data)\n>       assert code_resp.status_code == 200, code_resp.text\nE       AssertionError: <html>\r\nE       <head><title>403 Forbidden</title></head>\r\nE       <body>\r\nE       <center><h1>403 Forbidden</h1></center>\r\nE       </body>\r\nE       </html>\n\nutilities/api_gen_token.py:46: AssertionError","steps":[],"attachments":[{"uid":"5586ef4399bdbbc0","name":"Step Failed: Valid json payload is created where recorded has invalid 'empty' date","source":"5586ef4399bdbbc0.txt","type":"text/plain","size":218}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"epic","value":"Immunization Service"},{"name":"suite","value":"Create the immunization event for a patient"},{"name":"feature","value":"Create the immunization event for a patient"},{"name":"tag","value":"supplier_name_Postman_Auth"},{"name":"tag","value":"Create_Feature"},{"name":"tag","value":"vaccine_type_RSV"},{"name":"tag","value":"patient_id_Random"},{"name":"parentSuite","value":"features.APITests.steps"},{"name":"host","value":"runnervmf2e7y"},{"name":"thread","value":"2560-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"features.APITests.steps.test_create_steps"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"_pytest_bdd_example","value":"{'Date': 'empty', 'error_type': 'invalid_recorded'}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":2,"unknown":0,"total":3},"items":[{"uid":"61205ee28595ba25","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/130/#testresult/61205ee28595ba25","status":"passed","time":{"start":1762279655447,"stop":1762279657682,"duration":2235}},{"uid":"1a15b97e3ba0b915","reportUrl":"https://NHSDigital.github.io/imms_fhir_api_automation/129/#testresult/1a15b97e3ba0b915","status":"passed","time":{"start":1762274144871,"stop":1762274146544,"duration":1673}}]},"tags":["Create_Feature","patient_id_Random","supplier_name_Postman_Auth","vaccine_type_RSV"]},"source":"f5878c42140101d9.json","parameterValues":["{'Date': 'empty', 'error_type': 'invalid_recorded'}"]}